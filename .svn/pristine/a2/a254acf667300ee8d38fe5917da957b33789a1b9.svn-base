/*! zhoujiaqiang | shilei | liuxiaolin; last modify： 2017-05-22 */
"use strict";var myApp=angular.module("myApp",["ngRoute","ngCookies","ngAnimate","ngTouch","myControllers","myServices","myDirectives"]);myApp.constant("ST",{v:"?v="+(new Date).getTime()}),myApp.config(function($httpProvider,$routeProvider,ST){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",$httpProvider.interceptors.push("myInterceptor"),$routeProvider.when("/index",{templateUrl:"partials/index.html"+ST.v,controller:"IndexCtrl",access:!0}).when("/login",{templateUrl:"partials/login.html"+ST.v,controller:"LoginCtrl",access:!0}).when("/register1",{templateUrl:"partials/register1.html"+ST.v,controller:"Register1Ctrl",access:!0}).when("/register2/:mobile",{templateUrl:"partials/register2.html"+ST.v,controller:"Register2Ctrl",access:!0}).when("/agreementRegister",{templateUrl:"partials/agreementRegister.html"+ST.v,controller:"AgreementRegister",access:!0}).when("/myHome",{templateUrl:"partials/myHome.html"+ST.v,controller:"MyHomeCtrl",access:!1}).when("/myInfo",{templateUrl:"partials/myInfo.html"+ST.v,controller:"MyInfoCtrl",access:!1}).when("/forgetUserPass",{templateUrl:"partials/forgetUserPass.html"+ST.v,controller:"ForgetUserPassCtrl",access:!0}).when("/forgetTradePass",{templateUrl:"partials/forgetTradePass.html"+ST.v,controller:"ResetTradePassCtrl",access:!1}).when("/userPassModify",{templateUrl:"partials/userPassModify.html"+ST.v,controller:"UserPassModifyCtrl",access:!1}).when("/identification",{templateUrl:"partials/identification.html"+ST.v,controller:"IdentificationCtrl",access:!1}).when("/tradePassSet",{templateUrl:"partials/tradePassSet.html"+ST.v,controller:"TradePassSetCtrl",access:!1}).when("/tradePassModify",{templateUrl:"partials/tradePassModify.html"+ST.v,controller:"TradePassModifyCtrl",access:!1}).when("/payType",{templateUrl:"partials/payType.html"+ST.v,controller:"PayTypeCtrl",access:!1}).when("/payBank",{templateUrl:"partials/payBank.html"+ST.v,controller:"PayBankCtrl",access:!1}).when("/payMobile",{templateUrl:"partials/payMobile.html"+ST.v,controller:"PayMobileCtrl",access:!1}).when("/paySuccess",{templateUrl:"partials/paySuccess.html"+ST.v,controller:"PaySuccessCtrl",access:!1}).when("/bankInfo",{templateUrl:"partials/bankInfo.html"+ST.v,controller:"BankInfoCtrl",access:!1}).when("/bankCardList",{templateUrl:"partials/bankCardList.html"+ST.v,controller:"BankCardListCtrl",access:!1}).when("/addBankCard",{templateUrl:"partials/addBankCard.html"+ST.v,controller:"AddBankCardCtrl",access:!1}).when("/modifyBankCard/:bankCardId",{templateUrl:"partials/modifyBankCard.html"+ST.v,controller:"ModifyBankCardCtrl",access:!1}).when("/withdraw",{templateUrl:"partials/withdraw.html"+ST.v,controller:"WithdrawCtrl",access:!1}).when("/fund",{templateUrl:"partials/fund.html"+ST.v,controller:"FundCtrl",access:!1}).when("/notice",{templateUrl:"partials/notice.html"+ST.v,controller:"NoticeCtrl",access:!1}).when("/noticeDetail/:noticeId",{templateUrl:"partials/noticeDetail.html"+ST.v,controller:"NoticeDetailCtrl",access:!1}).when("/help",{templateUrl:"partials/help.html"+ST.v,controller:"HelpCtrl",access:!0}).when("/helpDetail/:helpDetailId",{templateUrl:"partials/helpDetail.html"+ST.v,controller:"HelpDetailCtrl",access:!0}).when("/helpCenter",{templateUrl:"partials/helpCenter.html"+ST.v,controller:"HelpCenterCtrl",access:!1}).when("/helpAsk",{templateUrl:"partials/helpAsk.html"+ST.v,controller:"HelpAskCtrl",access:!1}).when("/guide",{templateUrl:"partials/guide.html"+ST.v,controller:"GuideCtrl",access:!0}).when("/safe",{templateUrl:"partials/safe.html"+ST.v,controller:"SafeCtrl",access:!0}).when("/aboutUs",{templateUrl:"partials/aboutUs.html"+ST.v,controller:"AboutUsCtrl",access:!0}).when("/introduce",{templateUrl:"partials/introduce.html"+ST.v,controller:"IntroduceCtrl",access:!0}).when("/outerTrade/:commodityNo/:type",{templateUrl:"partials/outerTrade.html"+ST.v,controller:"OuterTradeCtrl",access:!0}).when("/outerTradeBuy/:commodityNo/:type/:buyChange",{templateUrl:"partials/outerTradeBuy.html"+ST.v,controller:"OuterTradeBuyCtrl",access:!1}).when("/outerTradeSell/:commodityNo/:type",{templateUrl:"partials/outerTradeSell.html"+ST.v,controller:"OuterTradeSellCtrl",access:!1}).when("/outerTradeResult/:commodityNo/:type",{templateUrl:"partials/outerTradeResult.html"+ST.v,controller:"OuterTradeResultCtrl",access:!1}).when("/outerAgreementSigned/:commodityNo",{templateUrl:"partials/outerAgreementSigned.html"+ST.v,controller:"OuterAgreementSignedCtrl",access:!1}).when("/agreementCL",{templateUrl:"partials/agreementCL.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementGC",{templateUrl:"partials/agreementGC.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementHSI",{templateUrl:"partials/agreementHSI.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementMHI",{templateUrl:"partials/agreementMHI.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementSI",{templateUrl:"partials/agreementSI.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementDAX",{templateUrl:"partials/agreementDAX.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementCN",{templateUrl:"partials/agreementCN.html"+ST.v,controller:"OuterAgreementCtrl",access:!0}).when("/agreementSaletorCL",{templateUrl:"partials/agreementSaletorCL.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/agreementSaletorGC",{templateUrl:"partials/agreementSaletorGC.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/agreementSaletorHSI",{templateUrl:"partials/agreementSaletorHSI.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/agreementSaletorMHI",{templateUrl:"partials/agreementSaletorMHI.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/agreementSaletorSI",{templateUrl:"partials/agreementSaletorSI.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/agreementSaletorDAX",{templateUrl:"partials/agreementSaletorDAX.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/agreementSaletorCN",{templateUrl:"partials/agreementSaletorCN.html"+ST.v,controller:"OuterAgreementSaletorCtrl",access:!0}).when("/tradeRuleCL",{templateUrl:"partials/tradeRuleCL.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/tradeRuleGC",{templateUrl:"partials/tradeRuleGC.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/tradeRuleHSI",{templateUrl:"partials/tradeRuleHSI.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/tradeRuleMHI",{templateUrl:"partials/tradeRuleMHI.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/tradeRuleSI",{templateUrl:"partials/tradeRuleSI.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/tradeRuleDAX",{templateUrl:"partials/tradeRuleDAX.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/tradeRuleCN",{templateUrl:"partials/tradeRuleCN.html"+ST.v,controller:"OuterTradeRuleCtrl",access:!0}).when("/settleNoInfo",{templateUrl:"partials/settleNoInfo.html"+ST.v,access:!0}).when("/alipay",{templateUrl:"partials/alipay.html"+ST.v,controller:"AlipayCtrl",access:!1}).when("/alipayDetail",{templateUrl:"partials/alipayDetail.html"+ST.v,controller:"AlipayDetailCtrl",access:!1}).when("/aliPayIdentification",{templateUrl:"partials/aliPayIdentification.html"+ST.v,controller:"AliPayIdentificationCtrl",access:!1}).when("/dev",{templateUrl:"partials/dev.html"+ST.v,controller:"DevCtrl",access:!0}).when("/article-20160831",{templateUrl:"partials/article-20160831.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/article-20161021",{templateUrl:"partials/article-20161021.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/article-20161130",{templateUrl:"partials/article-20161130.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/article-20161230",{templateUrl:"partials/article-20161230.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/article-20170109",{templateUrl:"partials/article-20170109.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/article-20170116",{templateUrl:"partials/article-20170116.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/article-20170309",{templateUrl:"partials/article-20170309.html"+ST.v,controller:"ArticleCtrl",access:!0}).when("/actPacket",{templateUrl:"partials/actPacket.html"+ST.v,controller:"ActPacketCtrl",access:!0}).when("/myPacket",{templateUrl:"partials/myPacket.html"+ST.v,controller:"MyPacketCtrl",access:!1}).when("/extension",{templateUrl:"partials/extension.html"+ST.v,controller:"ExtensionCtrl",access:!0}).when("/attentionWechat",{templateUrl:"partials/attentionWechat.html"+ST.v,controller:"AttentionCtrl",access:!1}).when("/phoneBind1",{templateUrl:"partials/phoneBind1.html"+ST.v,controller:"PhoneBind1Ctrl",access:!1}).when("/phoneBind2",{templateUrl:"partials/phoneBind2.html"+ST.v,controller:"PhoneBind2Ctrl",access:!1}).when("/oneYuanIntroduce",{templateUrl:"partials/oneYuanIntroduce.html"+ST.v,controller:"OneYuanIntroduceCtrl",access:!0}).when("/discover",{templateUrl:"partials/discover.html"+ST.v,controller:"DiscoverCtrl",access:!0}).when("/oneYuanTrade",{templateUrl:"partials/oneYuanTrade.html"+ST.v,controller:"OneYuanTradeCtrl",access:!0}).when("/oneYuanTradeBuy/:buyChange",{templateUrl:"partials/oneYuanTradeBuy.html"+ST.v,controller:"OneYuanTradeBuyCtrl",access:!1}).when("/oneYuanTradeSell",{templateUrl:"partials/oneYuanTradeSell.html"+ST.v,controller:"OneYuanTradeSellCtrl",access:!1}).when("/oneYuanTradeResult",{templateUrl:"partials/oneYuanTradeResult.html"+ST.v,controller:"OneYuanTradeResultCtrl",access:!1}).when("/news",{templateUrl:"partials/news.html"+ST.v,controller:"NewsCtrl",access:!0}).when("/dayGainList",{templateUrl:"partials/dayGainList.html"+ST.v,controller:"DayGainListCtrl",access:!0}).when("/activityCenter",{templateUrl:"partials/activityCenter.html"+ST.v,controller:"ActivityCenterCtrl",access:!0}).otherwise({redirectTo:"/index"})}).run(function($rootScope,$location,AuthService){$rootScope.$on("$routeChangeStart",function(evt,next){var key,backURL=next.originalPath;if(next.originalPath&&!next.access){for(key in next.params)backURL=backURL.replace(":"+key,next.params[key]);X.log("-----路由拦截 URL:"+backURL+"-----"),AuthService.auth()?X.log("-----用户已登录，放行-----"):(X.log("-----用户未登录，跳转到登录-----"),evt.preventDefault(),$location.path("/login").search({goURL:backURL}))}else X.log("-----路由放行 URL:"+next.originalPath+"-----")})});var myControllers=angular.module("myControllers",[]);myControllers.controller("IndexCtrl",function($scope,$location,$swipe,StockService,ADBannerService){function getFuturesQuote(){(isFirstFuturesQuote||isLoadFuturesQuote)&&(isFirstFuturesQuote=!1,isLoadFuturesQuote=!1,StockService.getFuturesSimpleQuote(commodityNo.join(",")).then(function(res){isLoadFuturesQuote=!0;var data=res.data;100==data.code&&processFuturesQuote(data.data),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}function getADBanner(){X.loading.show(),ADBannerService.getADBannerData().then(function(res){var data=res.data;100==data.code?(initADBannerData(data.data),showAD($scope.AD.id)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}function initADBannerData(data){var arr=[];for(var i in data)data[i]=arr[i]={id:data[i][0],title:data[i][1],type:data[i][2],imgURL:data[i][3],link:data[i][5]||"",btnName:data[i][6]||"",btnLink:data[i][8]||""},0==data[i].type?$scope.AD=data[i]:banners.push(data[i]);X.slide.init("mod-slide",banners,$swipe)}function showAD(id){if($scope.AD.imgURL&&$scope.AD.id){var storage=window.localStorage,ADID="ADID",ADIDStr=storage.getItem(ADID)||"";""!=ADIDStr&&ADIDStr==id||(storage.setItem(ADID,id),$scope.showADDialog=!0)}}function processFuturesQuote(data){if(data){var i,tempArr,datas=data.split(";"),len=datas.length;if(commodityNo.length==len)for(i=0;i<len;i++)tempArr=datas[i].split(","),$scope.future[commodityNo[i]]={price:tempArr[2],rote:tempArr[1]}}}X.loading.show();var commodityNo=["CL","GC","HSI","SI","DAX","CN","MHI"],isFirstFuturesQuote=!0,isLoadFuturesQuote=!0;$scope.stock={},$scope.future={};var banners=[];$scope.AD={},$scope.showADDialog=!1,$scope.urlJump=function(obj){if(obj.link){var link=obj.link;if(obj.btnName){var btnName=encodeURIComponent(obj.btnName),btnLink=encodeURIComponent(obj.btnLink);link=link+"?btnName="+btnName+"&btnLink="+btnLink}window.location.href=link}},getFuturesQuote(),getADBanner(),X.engine.addTask(getFuturesQuote,1e3),X.engine.start(),$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("LoginCtrl",function($rootScope,$scope,$location,LoginService,AuthService){$scope.goURL=$location.search().goURL||"/myHome",$scope.form={username:"",password:""},$scope.login=function(){return""==$scope.form.username?(X.tip("请输入您的账号"),!1):""==$scope.form.password?(X.tip("请输入登录密码"),!1):(X.loading.show(),void LoginService.login($scope.form.username,$scope.form.password).then(function(res){var data=res.data;data.authenticated?($rootScope.isLogin=!0,"/login"==$scope.backURL&&($scope.backURL="/myHome"),AuthService.signIn(data.userId),$location.url($scope.goURL),zhuge.identify(data.userId)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}}),myControllers.controller("Register1Ctrl",function($scope,$compile,$location,RegisterService){function timerFn(){timer=setInterval(function(){$scope.time>0?$scope.$apply(function(){$scope.time--}):timer&&clearTimeout(timer)},1e3)}function clearTimer(){$scope.time=0,timer&&clearTimeout(timer),timer=null}var timer=null;$scope.mobile="",$scope.time=0,$scope.temptimes=Date.now(),$scope.agreement=!0,$scope.checkCode="",$scope.imgCode="",$scope.showCodeDialog=!1,$scope.register=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?""==$scope.checkCode?(X.tip("请输入短信验证码"),!1):/^\d{4}$/.test($scope.checkCode)?$scope.agreement?(X.loading.show(),RegisterService.regNextStep($scope.mobile,$scope.checkCode).then(function(res){var data=res.data;100==data.code?$location.path("/register2/"+data.data):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),void zhuge.track("注册-开始注册")):(X.tip("请阅读并同意网站服务协议"),!1):(X.tip("验证码输入错误"),$scope.refreshCode(),!1):(X.tip("手机号码输入错误"),!1)},$scope.getImgCode=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?($scope.refreshCode(),void($scope.showCodeDialog=!0)):(X.tip("手机号码输入错误"),!1)},$scope.sendCode=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?""==$scope.imgCode?(X.tip("请输入图片验证码"),!1):/^\d{4}$/.test($scope.imgCode)?(X.loading.show(),void RegisterService.getRegisterCode($scope.mobile,$scope.imgCode).then(function(res){var data=res.data;100==data.code?($scope.closeDialog(),X.tip("验证码已发送至手机，请注意查收"),$scope.time=60,timerFn()):101==data.code?($scope.closeDialog(),X.tip("验证码已发送至手机，请注意查收"),$scope.time=data.data.interval,timerFn()):(X.tip(data.resultMsg),$scope.refreshCode()),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("图片验证码输入错误"),$scope.refreshCode(),!1):(X.tip("手机号码输入错误"),!1)},$scope.closeDialog=function(){$scope.showCodeDialog=!1,$scope.imgCode=""},$scope.refreshCode=function(){$scope.temptimes=Date.now()},$scope.$on("$destroy",function(){clearTimer()})}),myControllers.controller("Register2Ctrl",function($scope,$location,$routeParams,RegisterService,AuthService){$scope.mobile=$routeParams.mobile||"",""==$scope.mobile&&$location.url("/register1"),$scope.username="",$scope.password="",$scope.surepass="",$scope.register=function(){return""==$scope.username?(X.tip("用户名不能为空"),!1):X.strLen($scope.username)<4||X.strLen($scope.username)>16?(X.tip("用户名为4-16个字符，中文算2个字符"),!1):/^[0-9a-zA-Z_\u4e00-\u9fa5]+$/.test($scope.username)?!/^\w{6,16}$/.test($scope.password)||/^\d+$/.test($scope.password)||/^([a-zA-Z]+)$/.test($scope.password)?(X.tip("登录密码为6-16位数字和字母组成"),!1):$scope.password!=$scope.surepass?(X.tip("确认密码与密码不一致"),!1):(X.loading.show(),void RegisterService.doRegister($scope.mobile,$scope.username,$scope.password).then(function(res){var data=res.data;100==data.code?(X.tip("注册成功"),$location.path("/index"),zhuge.track("注册-完成注册"),AuthService.signIn(data.data)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("用户名只允许字母、数字、下划线或中文"),!1)}}),myControllers.controller("ForgetUserPassCtrl",function($scope,$location,PasswordService){function timerFn(){timer=setInterval(function(){$scope.time>0?$scope.$apply(function(){$scope.time--}):timer&&clearTimeout(timer)},1e3)}function clearTimer(){$scope.time=0,timer&&clearTimeout(timer),timer=null}var timer=null;$scope.backURL=$location.search().backURL||"/login",$scope.time=0,$scope.mobile="",$scope.checkCode="",$scope.newPass="",$scope.confirmPass="",$scope.imgCode="",$scope.showCodeDialog=!1,$scope.temptimes=Date.now(),$scope.forgetUserPass=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?/^\d{6}$/.test($scope.checkCode)?""==$scope.newPass?(X.tip("请输入新登录密码"),!1):!/^\w{6,16}$/.test($scope.newPass)||/^\d+$/.test($scope.newPass)||/^([a-zA-Z]+)$/.test($scope.newPass)?(X.tip("登录密码为6-16位数字和字母组成"),!1):""==$scope.confirmPass?(X.tip("请输入确认密码"),!1):$scope.confirmPass!=$scope.newPass?(X.tip("两次密码输入不一致"),!1):(X.loading.show(),void PasswordService.resetForgetPassword($scope.mobile,$scope.checkCode,$scope.newPass).then(function(res){var data=res.data;100==data.code?(X.tip("密码重置成功，请重新登录"),$location.path("/login")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("验证码输入错误"),!1):(X.tip("手机号码错误"),!1)},$scope.getImgCode=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?($scope.refreshCode(),void($scope.showCodeDialog=!0)):(X.tip("手机号码输入错误"),!1)},$scope.closeDialog=function(){$scope.showCodeDialog=!1,$scope.imgCode=""},$scope.refreshCode=function(){$scope.temptimes=Date.now()},$scope.sendCode=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?""==$scope.imgCode?(X.tip("请输入图片验证码"),!1):/^\d{4}$/.test($scope.imgCode)?(X.loading.show(),void PasswordService.sendForgetCode($scope.mobile,$scope.imgCode).then(function(res){var data=res.data;100==data.code?($scope.closeDialog(),X.tip("验证码已发送至手机，请注意查收"),$scope.time=60,timerFn()):101==data.code?($scope.closeDialog(),X.tip("验证码已发送至手机，请注意查收"),$scope.time=data.data.interval,timerFn()):(X.tip(data.resultMsg),$scope.refreshCode()),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("图片验证码输入错误"),$scope.refreshCode(),!1):(X.tip("手机号码输入错误"),!1)},$scope.$on("$destroy",function(){clearTimer()})}),myControllers.controller("IdentificationCtrl",function($scope,$location,UserService){$scope.backURL=$location.search().backURL||"/myInfo",$scope.name="",$scope.IDNum="",$scope.certification=function(){return""==$scope.name?(X.tip("请输入您的姓名"),!1):X.isChinaName($scope.name)?""==$scope.IDNum?(X.tip("请输入身份证号码"),!1):X.isIdentityNumber($scope.IDNum)?(X.loading.show(),void UserService.realName($scope.name,$scope.IDNum).then(function(res){var data=res.data;100==data.code?(X.tip("实名认证成功"),$location.url($scope.backURL)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("身份证号码错误"),!1):(X.tip("请输入正确的姓名"),!1)}}),myControllers.controller("UserPassModifyCtrl",function($scope,$location,PasswordService,AuthService){$scope.oldPassword="",$scope.newPassword="",$scope.surePassword="",$scope.changePass=function(){return""==$scope.oldPassword?(X.tip("请输入原登录密码"),!1):!/^\w{6,16}$/.test($scope.oldPassword)||/^\d+$/.test($scope.oldPassword)||/^([a-zA-Z]+)$/.test($scope.oldPassword)?(X.tip("原登录密码输入错误"),!1):""==$scope.newPassword?(X.tip("请输入新密码"),!1):!/^\w{6,16}$/.test($scope.newPassword)||/^\d+$/.test($scope.newPassword)||/^([a-zA-Z]+)$/.test($scope.newPassword)?(X.tip("密码为6-16位数字和字母组成"),!1):""==$scope.surePassword?(X.tip("请输入确认密码"),!1):$scope.surePassword!=$scope.newPassword?(X.tip("新密码与确认密码不一致"),!1):$scope.oldPassword.length<6?(X.tip("原登录密码错误"),!1):$scope.newPassword==$scope.oldPassword?(X.tip("新密码不能与原始密码相同"),!1):(X.loading.show(),void PasswordService.loginPwdModify($scope.oldPassword,$scope.newPassword).then(function(res){var data=res.data;100==data.code?(X.tip("密码修改成功，请重新登录"),AuthService.signOut(),$location.path("/login")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}}),myControllers.controller("TradePassSetCtrl",function($scope,$location,PasswordService){$scope.backURL=$location.search().backURL||"/myInfo",$scope.password="",$scope.surePassword="",$scope.tradePassSet=function(){return""==$scope.password?(X.tip("请输入提现密码"),!1):/^\d{6}$/.test($scope.password)?""==$scope.surePassword?(X.tip("请输入确认密码"),!1):$scope.password!=$scope.surePassword?(X.tip("两次密码不一致"),!1):(X.loading.show(),void PasswordService.PwdSet($scope.password,$scope.surePassword).then(function(res){var data=res.data;100==data.code?(X.tip("提现密码设置成功"),$location.url($scope.backURL)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("提现密码为6位数字"),!1)}}),myControllers.controller("TradePassModifyCtrl",function($scope,$location,PasswordService){$scope.oldPwd="",$scope.newPwd="",$scope.surePwd="",$scope.tradePassModify=function(){return""==$scope.oldPwd?(X.tip("请输入原始提现密码"),!1):/^\d{6}$/.test($scope.oldPwd)?""==$scope.newPwd?(X.tip("请输入新提现密码"),!1):/^\d{6}$/.test($scope.newPwd)?""==$scope.surePwd?(X.tip("请输入确认密码"),!1):$scope.surePwd!=$scope.newPwd?(X.tip("新密码与确认密码不一致"),!1):$scope.newPwd==$scope.oldPwd?(X.tip("新密码不能与原始密码相同"),!1):(X.loading.show(),void PasswordService.PwdModify($scope.newPwd,$scope.oldPwd).then(function(res){var data=res.data;100==data.code?(X.tip("提现密码修改成功"),$location.path("/myInfo")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("提现密码为6位数字"),!1):(X.tip("原始提现密码为6位数字"),!1)}}),myControllers.controller("ResetTradePassCtrl",function($scope,$location,$q,PasswordService,UserService){function timerFn(){timer=setInterval(function(){$scope.time>0?$scope.$apply(function(){$scope.time--}):timer&&clearTimeout(timer)},1e3)}var timer=null;$scope.backURL=$location.search().backURL||"/myInfo",$scope.mobile="",$scope.hideMobile="",$scope.checkCode="",$scope.password="",$scope.surePassword="",$scope.time=0,X.loading.show(),$q.all({userInfo:UserService.getUserInfo()}).then(function(res){var userInfoData=res.userInfo.data;100==userInfoData.code?($scope.mobile=userInfoData.data.loginMobileNoHidden,$scope.hideMobile=userInfoData.data.loginMobile):X.tip(userInfoData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.resetTradePassInfo=function(){return""==$scope.checkCode?(X.tip("请输入验证码"),!1):/^\d{6}$/.test($scope.checkCode)?""==$scope.password?(X.tip("请输入提现密码"),!1):/^\d{6}$/.test($scope.password)?""==$scope.surePassword?(X.tip("请输入确认密码"),!1):$scope.surePassword!=$scope.password?(X.tip("提现密码与确认密码不符"),!1):(X.loading.show(),void PasswordService.resetWithdrawPwd($scope.password,$scope.checkCode).then(function(res){var resetWithdrawPwdData=res.data;100==resetWithdrawPwdData.code?(X.tip("提现密码修改成功"),$location.url($scope.backURL)):X.tip(resetWithdrawPwdData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("提现密码为6位数字"),!1):(X.tip("验证码输入有误"),!1)},$scope.getPasswordCode=function(){PasswordService.sendPasswordCode($scope.mobile).then(function(res){var data=res.data;100==data.code?($scope.time=60,X.tip("验证码已发送至手机，请注意查收"),timerFn()):101==data.code?($scope.time=data.data.interval,timerFn()):X.tip(data.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})},$scope.$on("$destroy",function(){timer&&clearTimeout(timer)})}),myControllers.controller("MyHomeCtrl",function($scope,$q,$location,UserService){function bootURL(url){$scope.$apply(function(){$location.url(url)})}$scope.user={},$scope.bankCards=[],X.loading.show(),$q.all({userInfo:UserService.getUserInfo(),balance:UserService.getBalance(),bankCards:UserService.getBankCards()}).then(function(res){var userInfoData=res.userInfo.data,balanceData=res.balance.data,bankCardsData=res.bankCards.data;100==userInfoData.code&&100==balanceData.code&&100==bankCardsData.code?($scope.user=userInfoData.data,$scope.user.balance=balanceData.data.balance,$scope.bankCards=bankCardsData.data):100!=userInfoData.code?X.tip(userInfoData.resultMsg):100!=balanceData.code?X.tip(balanceData.resultMsg):100!=bankCardsData.code&&X.tip(bankCardsData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.doWithdraw=function(){return $scope.user.named?0==$scope.user.balance?void X.tip("您的账户没有可提金额"):$scope.bankCards.length?$scope.user.withdrawPw?void $location.path("/withdraw"):void X.dialog.confirm("您还未设置提现密码",{sureBtn:"马上设置",notify:function(nt){1==nt&&bootURL("/tradePassSet?backURL=/withdraw")}}):void X.dialog.confirm("提款前请先添加提款银行卡",{sureBtn:"添加银行卡",notify:function(nt){1==nt&&bootURL("/addBankCard?backURL=/myHome")}}):void X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&bootURL("/identification?backURL=/myHome")}})}}),myControllers.controller("MyInfoCtrl",function($scope,$rootScope,$q,$location,LoginService,UserService,AuthService){function signOut(){X.loading.show(),LoginService.logout().then(function(res){var data=res.data;100==data.code?(AuthService.signOut(),$location.url("/index")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}$scope.user={},$scope.bankCards=[],X.loading.show(),$q.all({userInfo:UserService.getUserInfo(),bankCards:UserService.getBankCards()}).then(function(res){var userInfoData=res.userInfo.data,bankCardsData=res.bankCards.data;100==userInfoData.code&&100==bankCardsData.code?($scope.user=userInfoData.data,$scope.bankCards=bankCardsData.data):100!=userInfoData.code?X.tip(userInfoData.resultMsg):100!=bankCardsData.code&&X.tip(bankCardsData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.telTip=function(){X.dialog.alert('如需要更换或解绑支付宝账号，请 <br>联系客服电话 <a class="txt-blue" href="tel:4008888566">4008888566</a>')},$scope.logout=function(){X.dialog.confirm("确定要退出当前账号吗？",{notify:function(nt){1==nt&&signOut()}})}}),myControllers.controller("NoticeCtrl",function($scope,$q,$location,NoticeService){$scope.items=[],$scope.pageIndex=1,$scope.totalPage=1,$scope.getNoticeList=function(page){var pageSize=10;X.loading.show(),NoticeService.getNoticeList(page,pageSize).then(function(res){var data=res.data;if(100==data.code){var noticeData=data.data;$scope.pageIndex=noticeData.pageIndex,$scope.totalPage=noticeData.totalPage,1==page?$scope.items=noticeData.items:$scope.items=$scope.items.concat(noticeData.items)}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.getNoticeList($scope.pageIndex)}),myControllers.controller("NoticeDetailCtrl",function($scope,$q,$location,$sce,$routeParams,NoticeService){var noticeId=$routeParams.noticeId;return noticeId?($scope.notice={},X.loading.show(),void $q.all({noticeDetail:NoticeService.getNoticeById(noticeId)}).then(function(res){var noticeDetail=res.noticeDetail.data;100==noticeDetail.code?($scope.notice=noticeDetail.data,$scope.notice.noticeContent=$sce.trustAsHtml(noticeDetail.data.noticeContent)):X.tip(noticeDetail.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("公告ID不能为空"),void $location.path("/notice"))}),myControllers.controller("HelpCtrl",function($scope,$location){$scope.backURL=$location.search().backURL||"/index",$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1),$scope.toHelpCenter=function(){$scope.showHeader?$location.path("/helpCenter"):window.location="jumpCenter::suggestion"}}),myControllers.controller("HelpDetailCtrl",function($scope,$location,$sce,$routeParams){$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1);var detailId=$routeParams.helpDetailId,helpObjs={QA0001:{title:"用户名无法登录怎么办？",content:$sce.trustAsHtml("<p>使用注册手机号码也可以登录。</p>")},QA0002:{title:"忘记登录密码如何获取？",content:$sce.trustAsHtml("<p>可以用注册手机找回密码。</p><P>操作流程：选择登录 —— 点击忘记密码 —— 输入手机号码 —— 获取验证码 —— 输入新登录密码 —— 修改成功。</P>")},QA0003:{title:"获取短信验证码失败怎么办？",content:$sce.trustAsHtml("<p>检查是否输错手机号码。如无问题，请致电400-8888-566客服热线进行处理。</p>")},QA0004:{title:"登录的方式有哪些？",content:$sce.trustAsHtml("<p>支持微信公众号、app、pc进行登录。</P>")},QB0001:{title:"如何充值？",content:$sce.trustAsHtml("<p>微信端/APP端目前支持银行卡快捷充值、支付宝转账，在线充值立即到账。</p>")},QB0002:{title:"充值提现有什么限制吗？提现多久到账？",content:$sce.trustAsHtml("<p>1、充值最低100元。</p><p>2、交易结算后、或者账户有余额，可随时申请提出现金。</p><p>3、单次提款金额最低100元起提，提款采用银行批量转账，到账时间以银行为准，一般处理时间需要1-2个工作日左右，节假日将延后处理。</p>")},QB0003:{title:"为什么银行卡会充值失败？",content:$sce.trustAsHtml("<p>1、确保银行卡号、姓名、银行预留身份号、身份证号、开户银行是否保持一致。</p><p>2、充值失败可致电400-8888-566获取帮助。</p>")},QB0004:{title:"快捷支付收不到验证码怎么办？",content:$sce.trustAsHtml("<p>1、请核实手机号是否为该银行卡的绑定手机，手机是否设置短信拦截功能。</p><p>2、因支付验证码是由第三方支付公司发出的，如仍收不到验证码，请致电400-8888-566客服热线咨询并获取帮助。</p>")},QC0001:{title:"什么是履约保证金？",content:$sce.trustAsHtml("<p>1、履约保证金为点买人委托平台冻结用于履约交易亏损赔付义务的保证金。</p><p>2、点买人以冻结的履约保证金作为承担交易亏损赔付的上限。</p><p>3、多出上限部分的亏损全部由合作的投资人承担。</p><p>4、合作交易结束后，根据结算结果，如交易盈利，点买人冻结的履约保证金全额退还。如交易亏损，从冻结的履约保证金中，扣减操盘人所应承担的亏损赔付额，扣减后余额退还。</p>")},QC0002:{title:"交易的履约保证金是固定的还是浮动的？",content:$sce.trustAsHtml("<p>目前是固定的，根据投资人选择对应的交易手数叠加。</p>")},QC0003:{title:"交易过程中可以追加履约保证金吗？",content:$sce.trustAsHtml("<p>交易中不能追加履约保证金，所以开仓的时候，建议选择高保证金，下单成功后，可以自行设置止盈止损。</p>")},QC0004:{title:"风险较高容易被平仓，如何选择保证金档次？",content:$sce.trustAsHtml("<p>1、每个品种都有多个保证金档次可选的，客户可以按照自己的风险承受能力自由选择每笔的保证金档次。</p><p>2、比如客户可以用1340保证金做一手原油，也可以2010、2680的保证金做一手的原油，在开仓界面，触发止损中选择即可。履约保证金高，不容易被平仓。</p>")},QC0005:{title:"交易需要支付什么费用？",content:$sce.trustAsHtml("<p>交易过程中只需要支付每笔的交易综合费，不交易不收费，下单未成功撤单也不收费。</p>")},QC0006:{title:"交易时间费用和汇率是固定的吗？",content:$sce.trustAsHtml("<p>关于交易时间和交易综合费 、汇率，因期货公司变动，平台有可能进行调整，以平台公布的最新数据为准。</p>")},QD0001:{title:"盈亏如何分配？",content:$sce.trustAsHtml("<p>1、点买人与投资人合作交易，止盈金额以内的盈利，点买人拿90%，投资人拿10%。</p><p>2、超出止盈部分的盈利全部归合作的投资人所有，同时超出止亏部分的亏损也全部由投资人承担。</p>")},QD0002:{title:"如何设置止盈止损？是否有限制？",content:$sce.trustAsHtml("<p>下单成功后，在持仓信息里可自定义设置，止盈、止损有最大限制。</p>")},QD0003:{title:"国际期货的持仓盈亏是如何计算的？",content:$sce.trustAsHtml("<p>美原油、美黄金、美白银、富时A50是美元计价盈亏，已经在持仓里边自动按照固定的汇率换算成人民币，平仓会自动结算成人民币。恒指是以港币计价盈亏，已经在持仓里边自动按照固定的汇率换算成人民币，平仓会自动结算成人民币。德指是以欧元计价盈亏，已经在持仓里边自动按照固定的汇率换算成人民币，平仓会自动结算成人民币。</p>")},QD0004:{title:"是否支持限定价格卖出？",content:$sce.trustAsHtml("<p>暂时不支持。可以通过修改止盈止损去实现。</p>")}};$scope.helpObj=helpObjs[detailId]}),myControllers.controller("HelpCenterCtrl",function($scope,UserService){var pageSize=6;$scope.helpList=[],$scope.currPage=1,$scope.totalPage=1,$scope.getHelpList=function(page){X.loading.show(),UserService.getMsgPage(page,pageSize).then(function(res){var msgListData=res.data;if(100==msgListData.code){var data=msgListData.data;$scope.helpList=$scope.helpList.concat(data.items),$scope.currPage=data.pageIndex,$scope.totalPage=data.totalPage}else X.tip(msgListData.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.getHelpList(1)}),myControllers.controller("HelpAskCtrl",function($scope,$location,UserService){$scope.types=["请选择留言类型","账户充值及提款问题","点买点卖问题","结算问题","我要投诉","意见反馈","其他问题"],$scope.type="请选择留言类型",$scope.content="",$scope.postMsg=function(){return"请选择留言类型"==$scope.type?void X.tip("请选择留言类型"):X.strLen($scope.content)<1||X.strLen($scope.content)>300?void X.tip("留言内容不符合规范"):(X.loading.show(),void UserService.postMsg($scope.type,"",$scope.content).then(function(res){var data=res.data;100==data.code?(X.tip("留言成功"),$location.path("/helpCenter")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}}),myControllers.controller("OuterTradeCtrl",function($scope,$q,$routeParams,TradeService,StockService,SystemService){function init(data){var serverTime=data.nowTime,risk=JSON.parse(data.strRisk);isTrade="1"==risk.isTrade.value;var holiday=SystemService.parseHoliday(risk.holiday.value),tradeTime=SystemService.parsePeriod(risk.tradingTimeLimit.value),quoteTime=SystemService.parsePeriod(risk.quoteTime.value);SystemService.setCurrentTime(serverTime),SystemService.setCurrentCurrencyType("USD"),
SystemService.setHoliday(holiday),SystemService.setTradePeriod(tradeTime),SystemService.setQuotePeriod(quoteTime,$scope.commodityNo),getFuturesQuote(!0),X.engine.addTask(getFuturesQuote,500),X.engine.start()}function resize(){var els=["#sline-wrap-"+$scope.uuid,"#kline-wrap-"+$scope.uuid,"#tline-wrap-"+$scope.uuid],height=$(window).height();els.forEach(function(id){var top=223,h=height-top-103-5;$(id).height(h)})}function getFuturesSline(){StockService.getFuturesSline($scope.commodityNo).then(function(res){var sLineData=res.data;100==sLineData.code?drawSline(sLineData.data):X.tip(sLineData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function getFuturesKline(){StockService.getFuturesKline($scope.commodityNo,$scope.klineInfo.type).then(function(res){var kLineData=res.data;100==kLineData.code?drawKline(kLineData.data):X.tip(kLineData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function drawSline(sLineDataStr){if(resize(),QUOTE_DATA){var lastTime,slineData=sLineDataStr.split(";"),data={};slineData.forEach(function(str){var arr=str.split(",");lastTime=X.formatDate(X.toInt(arr[0]),"hm")-0,data[lastTime]={current:X.toFloat(arr[1]),volume:0,time:lastTime}}),sChart=new X.Sline(chartOpts.sline[$scope.commodityNo]),sChart.draw({data:data,close:X.toFloat(QUOTE_DATA.yesterdayPrice),high:X.toFloat(QUOTE_DATA.highPrice),low:X.toFloat(QUOTE_DATA.lowPrice),quoteTime:lastTime,code:$scope.commodityNo,period:SystemService.getRealPeriod($scope.commodityNo,lastTime),isIntl:isIntl($scope.commodityNo)})}}function drawKline(dataStr){var klineData=dataStr.split(";");"dayKline"==$scope.klineInfo.type&&klineData.reverse();var data=[];klineData.forEach(function(str){var arr=str.split(","),o={timestamp:arr[0]-0,time:X.formatDate(arr[0]-0,$scope.klineInfo.dt),open:X.toFloat(arr[4]),high:X.toFloat(arr[2]),low:X.toFloat(arr[3]),price:X.toFloat(arr[5])};data.push(o)}),kChart||(kChart=new X.Kline(chartOpts.kline[$scope.commodityNo])),kChart.draw(data),"oneMKline"==$scope.klineInfo.type?CACHE_1KLINE=data:"threeMKline"==$scope.klineInfo.type?CACHE_3KLINE=data:"fiveMKline"==$scope.klineInfo.type?CACHE_5KLINE=data:"fifteenMKline"==$scope.klineInfo.type?CACHE_15KLINE=data:CACHE_KLINE=data}function drawTick(){tChart=new X.Tick(chartOpts.tline[$scope.commodityNo]),tChart.draw({time:QUOTE_DATA.time,price:X.toFloat(QUOTE_DATA.newPrice)})}function perDrawSline(data){var o={current:X.toFloat(data.newPrice),volume:0,time:X.formatDate(data.time,"hm")-0};sChart&&sChart.perDraw(o,{close:X.toFloat(data.yesterdayPrice),high:X.toFloat(data.highPrice),low:X.toFloat(data.lowPrice),quoteTime:o.time,code:$scope.commodityNo,period:SystemService.getRealPeriod($scope.commodityNo,o.time),isIntl:isIntl($scope.commodityNo)})}function perDrawKline(data){if(0!=data.newPrice&&$scope.klineInfo){var last,nextTime,o;CACHE_KLINE&&CACHE_KLINE.length&&(last=CACHE_KLINE[CACHE_KLINE.length-1],o={timestamp:data.time,time:X.formatDate(data.time,"YMD"),open:data.openPrice,high:data.highPrice,low:data.lowPrice,price:data.newPrice},last.time===o.time?CACHE_KLINE[CACHE_KLINE.length-1]=o:CACHE_KLINE.push(o)),CACHE_1KLINE&&CACHE_1KLINE.length&&(last=CACHE_1KLINE[CACHE_1KLINE.length-1],nextTime=last.timestamp+6e4,data.time<nextTime?CACHE_1KLINE[CACHE_1KLINE.length-1]={timestamp:last.timestamp,time:last.time,open:last.open,high:Math.max(data.newPrice,last.high),low:Math.min(data.newPrice,last.low),price:data.newPrice}:(TEMP_1K={timestamp:data.time,time:X.formatDate(data.time,"hm"),open:data.newPrice,high:data.newPrice,low:data.newPrice,price:data.newPrice},CACHE_1KLINE.push(TEMP_1K))),CACHE_3KLINE&&CACHE_3KLINE.length&&(last=CACHE_3KLINE[CACHE_3KLINE.length-1],nextTime=last.timestamp+18e4,data.time<nextTime?CACHE_3KLINE[CACHE_3KLINE.length-1]={timestamp:last.timestamp,time:last.time,open:last.open,high:Math.max(data.newPrice,last.high),low:Math.min(data.newPrice,last.low),price:data.newPrice}:(TEMP_3K={timestamp:data.time,time:X.formatDate(data.time,"hm"),open:data.newPrice,high:data.newPrice,low:data.newPrice,price:data.newPrice},CACHE_3KLINE.push(TEMP_3K))),CACHE_5KLINE&&CACHE_5KLINE.length&&(last=CACHE_5KLINE[CACHE_5KLINE.length-1],nextTime=last.timestamp+3e5,data.time<nextTime?CACHE_5KLINE[CACHE_5KLINE.length-1]={timestamp:last.timestamp,time:last.time,open:last.open,high:Math.max(data.newPrice,last.high),low:Math.min(data.newPrice,last.low),price:data.newPrice}:(TEMP_5K={timestamp:data.time,time:X.formatDate(data.time,"hm"),open:data.newPrice,high:data.newPrice,low:data.newPrice,price:data.newPrice},CACHE_5KLINE.push(TEMP_5K))),CACHE_15KLINE&&CACHE_15KLINE.length&&(last=CACHE_15KLINE[CACHE_15KLINE.length-1],nextTime=last.timestamp+9e5,data.time<nextTime?CACHE_15KLINE[CACHE_15KLINE.length-1]={timestamp:last.timestamp,time:last.time,open:last.open,high:Math.max(data.newPrice,last.high),low:Math.min(data.newPrice,last.low),price:data.newPrice}:(TEMP_15K={timestamp:data.time,time:X.formatDate(data.time,"hm"),open:data.newPrice,high:data.newPrice,low:data.newPrice,price:data.newPrice},CACHE_15KLINE.push(TEMP_15K)));var currData;currData="oneMKline"==$scope.klineInfo.type?CACHE_1KLINE:"threeMKline"==$scope.klineInfo.type?CACHE_3KLINE:"fiveMKline"==$scope.klineInfo.type?CACHE_5KLINE:"fifteenMKline"==$scope.klineInfo.type?CACHE_15KLINE:CACHE_KLINE,kChart&&kChart.draw(currData)}}function perDrawTick(data){tChart&&tChart.draw({time:data.time,price:X.toFloat(data.newPrice)})}function getFuturesQuote(flag){isTrade?($scope.isInPeriod=SystemService.isInPeriod($scope.commodityNo,"trade"),$scope.isInPeriod?$scope.tips="本时段"+SystemService.getTipsForTradeStopTime($scope.commodityNo):$scope.tips="已休市，"+SystemService.getTipsForNextTime($scope.commodityNo)):($scope.isInPeriod=!1,$scope.tips="暂停交易");var isInQuoteTime=SystemService.isInPeriod($scope.commodityNo,"quote");flag||isInQuoteTime||$scope.$apply(),isLoadFuturesQuote&&isInQuoteTime&&(isLoadFuturesQuote=!1,StockService.getFuturesQuote($scope.commodityNo).then(function(res){isLoadFuturesQuote=!0;var data=res.data;100==data.code?processQuoteData(data.data):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}function processQuoteData(data){var futureArr;if(data){futureArr=data.split(",");var baseNum=50,buyNum=X.toInt(futureArr[12]),sellNum=X.toInt(futureArr[13]),buyNumRate=buyNum/baseNum*100,sellNumRate=sellNum/baseNum*100;buyNumRate>100&&(buyNumRate=100),sellNumRate>100&&(sellNumRate=100),QUOTE_DATA={commodityTitle:$scope.commodityTitles[$scope.commodityNo],contractNo:futureArr[0],time:futureArr[1]-0,openPrice:futureArr[2],yesterdayPrice:futureArr[3],changeValue:futureArr[4],changeQuote:futureArr[5],highPrice:futureArr[6],lowPrice:futureArr[7],total:X.sketchNumber(futureArr[8],2),newPrice:futureArr[9],buyPrice:futureArr[10],sellPrice:futureArr[11],buyNum:buyNum,sellNum:sellNum,buyNumRate:buyNumRate,sellNumRate:sellNumRate},$scope.futureInfo=QUOTE_DATA,perDrawTick(QUOTE_DATA),perDrawSline(QUOTE_DATA),perDrawKline(QUOTE_DATA)}}function isIntl(commNo){return"GC"==commNo||"CL"==commNo||"SI"==commNo||"DAX"==commNo}$scope.uuid=SystemService.uuid(),$scope.commodityNo=$routeParams.commodityNo||"CL",$scope.type=$routeParams.type||"2","1"!=$scope.type&&($scope.type="2");var tChart,sChart,kChart,QUOTE_DATA,CACHE_KLINE,CACHE_1KLINE,CACHE_3KLINE,CACHE_5KLINE,CACHE_15KLINE,TEMP_1K,TEMP_3K,TEMP_5K,TEMP_15K,chartOpts={sline:{CL:{wrap:"sline-wrap-"+$scope.uuid,scale:2},GC:{wrap:"sline-wrap-"+$scope.uuid,scale:1},HSI:{wrap:"sline-wrap-"+$scope.uuid,scale:0},MHI:{wrap:"sline-wrap-"+$scope.uuid,scale:0},SI:{wrap:"sline-wrap-"+$scope.uuid,scale:3},DAX:{wrap:"sline-wrap-"+$scope.uuid,scale:1},CN:{wrap:"sline-wrap-"+$scope.uuid,scale:1}},kline:{CL:{wrap:"kline-wrap-"+$scope.uuid},GC:{wrap:"kline-wrap-"+$scope.uuid},HSI:{wrap:"kline-wrap-"+$scope.uuid},MHI:{wrap:"kline-wrap-"+$scope.uuid},SI:{wrap:"kline-wrap-"+$scope.uuid},DAX:{wrap:"kline-wrap-"+$scope.uuid},CN:{wrap:"kline-wrap-"+$scope.uuid}},tline:{CL:{wrap:"tline-wrap-"+$scope.uuid,unit:.01,multiple:2},GC:{wrap:"tline-wrap-"+$scope.uuid,unit:.1,multiple:2},HSI:{wrap:"tline-wrap-"+$scope.uuid,unit:1,multiple:2},MHI:{wrap:"tline-wrap-"+$scope.uuid,unit:1,multiple:2},SI:{wrap:"tline-wrap-"+$scope.uuid,unit:.005,multiple:2},DAX:{wrap:"tline-wrap-"+$scope.uuid,unit:.5,multiple:2},CN:{wrap:"tline-wrap-"+$scope.uuid,unit:2.5,multiple:2}}},isLoadFuturesQuote=!0,isTrade=!1;$scope.commodityTitles={CL:"美原油",GC:"美黄金",SI:"美白银",HSI:"恒指",MHI:"小恒指",CN:"富时A50",DAX:"德指"},$scope.showMenu=!1,$scope.futureInfo={},$scope.currType="sline",$scope.tips="",$scope.isInPeriod=!1,$scope.showKillwrap=!1,$scope.currKLineIndex=4,$scope.klineInfo=null,$scope.klineTypes=[{title:"1分钟",type:"oneMKline",dt:"hm"},{title:"3分钟",type:"threeMKline",dt:"hm"},{title:"5分钟",type:"fiveMKline",dt:"hm"},{title:"15分钟",type:"fifteenMKline",dt:"hm"},{title:"日线",type:"dayKline",dt:"YMD"}],X.loading.show(),$q.all({risk:TradeService.getRisk($scope.commodityNo),quote:StockService.getFuturesQuote($scope.commodityNo)}).then(function(res){var riskData=res.risk.data,quoteData=res.quote.data;100==riskData.code&&100==quoteData.code?(processQuoteData(quoteData.data),init(riskData.data),$scope.switchPanel("sline"),$scope.klineInfo=$scope.klineTypes[$scope.currKLineIndex]):100!=riskData.code?X.tip(riskData.resultMsg):100!=quoteData.code&&X.tip(quoteData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.switchPanel=function(type){"kline"==$scope.currType&&"kline"==type?$scope.showKillwrap=!$scope.showKillwrap:$scope.showKillwrap=!1,$scope.currType=type,"sline"!=type||sChart?"tline"!=type||tChart?"kline"!=type||kChart||getFuturesKline():drawTick():getFuturesSline()},$scope.switchKL=function(index,$event){$event.stopPropagation(),$scope.showKillwrap=!1,$scope.klineInfo=$scope.klineTypes[index],"oneMKline"==$scope.klineInfo.type&&!CACHE_1KLINE||"threeMKline"==$scope.klineInfo.type&&!CACHE_3KLINE||"fiveMKline"==$scope.klineInfo.type&&!CACHE_5KLINE||"fifteenMKline"==$scope.klineInfo.type&&!CACHE_15KLINE||"dayKline"==$scope.klineInfo.type&&!CACHE_KLINE?getFuturesKline():"oneMKline"==$scope.klineInfo.type&&CACHE_1KLINE?kChart.draw(CACHE_1KLINE):"threeMKline"==$scope.klineInfo.type&&CACHE_3KLINE?kChart.draw(CACHE_3KLINE):"fiveMKline"==$scope.klineInfo.type&&CACHE_5KLINE?kChart.draw(CACHE_5KLINE):"fifteenMKline"==$scope.klineInfo.type&&CACHE_15KLINE?kChart.draw(CACHE_15KLINE):"dayKline"==$scope.klineInfo.type&&CACHE_KLINE&&kChart.draw(CACHE_KLINE)},$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("OuterTradeBuyCtrl",function($scope,$q,$routeParams,$location,StockService,TradeService,UserService,PacketService,SystemService){function init(data){$scope.balance=data.balance,$scope.signAgreement=data.signAgreement,$scope.token=data.token;var newTime=data.nowTime,risk=JSON.parse(data.strRisk),tradeTimeStr=risk.tradingTimeLimit.value;$scope.commodityTitle=risk.futuresName.value,$scope.contractNo=risk.contractCode.value,$scope.tradeNumList=risk.number.value.split(","),$scope.tradeNumber=$scope.tradeNumList[0],$scope.serviceCharge=risk.serviceCharge.value,$scope.value=risk.contractValue.value,$scope.profitMultiple=risk.quitGainValue.value;var lossCount=risk.quitCloseRatio.value.split(",");$scope.lossCountLen=[];for(var i=0;i<lossCount.length;i++)$scope.lossCountLen.push(X.toInt(lossCount[i]));$scope.lossScale=risk.lossRatio.value,$scope.exchangeRate=risk.exchangeRate.value,amount&&quitCloseRatio&&$scope.tradeNumList.indexOf(amount)!=-1&&lossCount.indexOf(quitCloseRatio)!=-1&&($scope.tradeIndex=$scope.tradeNumList.indexOf(amount),$scope.tradeNumber=amount,$scope.lowIndex=lossCount.indexOf(quitCloseRatio));var holiday=SystemService.parseHoliday(risk.holiday.value),tradeTime=SystemService.parsePeriod(tradeTimeStr),quoteTime=SystemService.parsePeriod(risk.quoteTime.value);isTrade="1"==risk.isTrade.value,SystemService.setCurrentTime(newTime),SystemService.setCurrentCurrencyType("USD"),SystemService.setHoliday(holiday),SystemService.setTradePeriod(tradeTime),SystemService.setQuotePeriod(quoteTime,$scope.commodityNo),getFutures(!0),X.engine.addTask(getFutures,500),X.engine.start()}function initValidate(){"1"!=$scope.type&&X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&$location.url("/identification?backURL=/outerTradeBuy/"+$scope.commodityNo+"/"+$scope.type+"/"+$scope.buyChange),0==nt&&$location.url("/outerTrade/"+$scope.commodityNo+"/"+$scope.type)}})}function showNewContractNo(contractNo){var storage=window.localStorage,CONTRACTNO="CONTRACTNO",contractNoStr=storage.getItem(CONTRACTNO)||"";if(""==contractNoStr)return X.dialog.alert($scope.commodityTitle+"合约已更新为"+contractNo),void storage.setItem(CONTRACTNO,contractNo);var conTractNoArr=contractNoStr.split(",");conTractNoArr.indexOf(contractNo)==-1&&(X.dialog.alert($scope.commodityTitle+"合约已更新为"+contractNo),conTractNoArr.push(contractNo),storage.setItem(CONTRACTNO,conTractNoArr))}function getFutures(flag){isTrade?($scope.isInPeriod=SystemService.isInPeriod($scope.commodityNo,"trade"),$scope.isInPeriod?$scope.tips=SystemService.getTipsForTradeStopTime($scope.commodityNo):$scope.tips=SystemService.getTipsForNextTime($scope.commodityNo)):($scope.isInPeriod=!1,$scope.tips="暂停交易");var isInQuoteTime=SystemService.isInPeriod($scope.commodityNo,"quote");flag||isInQuoteTime||$scope.$apply(),isLoadFuturesQuote&&isInQuoteTime&&(isLoadFuturesQuote=!1,StockService.getFuturesQuote($scope.commodityNo).then(function(res){isLoadFuturesQuote=!0;var data=res.data;100==data.code?futureQuote(data.data):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}function futureQuote(data){if(data){var futureArr=data.split(",");$scope.futureInfo={contractNo:futureArr[0],buyPrice:futureArr[10],sellPrice:futureArr[11]}}}function getLossMoney(num){for(var i=0;i<$scope.lossCountLen.length;i++)$scope.lowMoneyList[i]=Math.round(num*$scope.lossCountLen[i]*$scope.exchangeRate*$scope.value*100)/100|0;$scope.lowMoney=Math.round(num*$scope.lossCountLen[$scope.lowIndex]*$scope.exchangeRate*$scope.value*100)/100|0,getServiceMoney(num)}function getServiceMoney(num){$scope.serviceMoney=$scope.serviceCharge*num,$scope.usTipBalance=Math.min($scope.serviceMoney,$scope.tipBalance)}function getPrincipal(){$scope.principal=Math.round($scope.tradeNumber*$scope.lossCountLen[$scope.lowIndex]*$scope.exchangeRate*$scope.value*100)/$scope.lossScale/100|0,getHighMoney(),getPrincipalPrice()}function getHighMoney(){$scope.highMoney=Math.round($scope.tradeNumber*$scope.lossCountLen[$scope.lowIndex]*$scope.exchangeRate*$scope.value*$scope.profitMultiple*100)/100|0}function getPrincipalPrice(){$scope.getPrincipalPrice=Math.round($scope.tradeNumber*$scope.lossCountLen[$scope.lowIndex]*$scope.value*100)/$scope.lossScale/100|0}function trade(){var direction="sell"==$scope.buyChange?"S":"B",postData={commodityNo:$scope.futureInfo.contractNo,type:$scope.type,useTip:"2"==$scope.type&&$scope.useTip,amount:$scope.tradeNumber,direction:direction,lossPrincipal:$scope.principal,gainPrincipal:$scope.highMoney,serviceCharge:$scope.serviceMoney,contractCode:$scope.contractNo,quitLoss:$scope.lowMoney,quitGain:$scope.highMoney,quitCloseRatio:$scope.lossCountLen[$scope.lowIndex],token:$scope.token};X.loading.show(),TradeService.createFuturesStrategy(postData).then(function(res){var data=res.data;100==data.code?(replaceToken(data),X.dialog.alert("点买成功",{notify:function(){$location.url("/outerTradeSell/"+$scope.commodityNo+"/"+$scope.type)}}),"2"==$scope.type&&zhuge.track("交易",{"名称":$scope.commodityNo})):(replaceToken(data),X.tip(data.resultMsg)),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}function replaceToken(data){var token=data.data;$scope.token=token.token}$scope.commodityNo=$routeParams.commodityNo||"CL",$scope.type=$routeParams.type||"2","1"!=$scope.type&&($scope.type="2"),$scope.buyChange=$routeParams.buyChange||"buy";var amount=$location.search().amount,quitCloseRatio=$location.search().quitCloseRatio,isLoadFuturesQuote=!0,isTrade=!1;$scope.tips="",$scope.isInperiod=!1,$scope.tradeIndex=0,$scope.highIndex=0,$scope.lowIndex=0,$scope.tradeNumber=0,$scope.highMoney=0,$scope.lowMoney=0,$scope.tradeNumList=[],$scope.highMoneyList=[],$scope.lowMoneyList=[],$scope.principal=0,$scope.serviceMoney=0,$scope.showLossMoney=!1,$scope.showCountNum=!1,$scope.selectedLowMoney=0,$scope.selectedCount=0,$scope.divisionsNum=3,$scope.countNum=5,$scope.signAgreement=!1,$scope.futureInfo={},$scope.tipBalance=0,$scope.usTipBalance=0,$scope.useTip=!0,X.loading.show(),$q.all({userInfo:UserService.getUserInfo(),getRiskInfo:TradeService.getRisk($scope.commodityNo),quote:StockService.getFuturesQuote($scope.commodityNo),packet:PacketService.getPacketFundInfoData()}).then(function(res){var userInfoData=res.userInfo.data,riskData=res.getRiskInfo.data,packetData=res.packet.data,quoteData=res.quote.data;100==userInfoData.code&&100==riskData.code&&100==quoteData.code&&100==packetData.code?($scope.userInfo=userInfoData.data,$scope.tipBalance=packetData.data.tipBalance,0==$scope.tipBalance&&($scope.useTip=!1),init(riskData.data),futureQuote(quoteData.data),$scope.chooseTradeNum($scope.tradeIndex,$scope.tradeNumber),$scope.chooseLossMoney($scope.lowIndex,$scope.lowMoney),$scope.userInfo.named?showNewContractNo($scope.contractNo):initValidate()):100!=userInfoData.code?X.tip(userInfoData.resultMsg):100!=riskData.code&&X.tip(riskData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.toTrade=function(){var needMoney=$scope.principal+$scope.serviceMoney,tradeT=SystemService.beyondTradeTimeTips($scope.commodityNo);if($scope.useTip&&(needMoney-=$scope.usTipBalance),!isTrade)return X.dialog.alert("暂停交易"),!1;if($scope.futureInfo.contractNo!=$scope.contractNo)return X.dialog.alert("合约交割变更期间，无法发起策略"),!1;var isInPeriod=SystemService.isInPeriod($scope.commodityNo,"trade");if(!isInPeriod)return X.dialog.alert(tradeT),!1;if("1"!=$scope.type){if($scope.balance<needMoney)return X.dialog.confirm("当前余额不足，<br>请充值后再发起策略。",{sureBtn:"去充值",notify:function(nt){1==nt&&$scope.$apply(function(){$location.url("/payType?backURL=/outerTradeBuy/"+$scope.commodityNo+"/"+$scope.type+"/"+$scope.buyChange)})}}),!1;if(!$scope.signAgreement)return $location.url("/outerAgreementSigned/"+$scope.commodityNo+"?backURL=/outerTradeBuy/"+$scope.commodityNo+"/"+$scope.type+"/"+$scope.buyChange),!1}trade()},$scope.chooseTradeNum=function(index,number){$scope.tradeIndex=index,$scope.tradeNumber=number,$scope.selectedCount=index,getLossMoney(number),getPrincipal()},$scope.chooseLossMoney=function(index,money){$scope.lowIndex=index,$scope.lowMoney=money,$scope.selectedLowMoney=index,getPrincipal()},$scope.showLoss=function(){$scope.showLossMoney=!$scope.showLossMoney},$scope.showCount=function(){$scope.showCountNum=!$scope.showCountNum},$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("OuterAgreementSignedCtrl",function($scope,$routeParams,$location,UserService){$scope.commodityNo=$routeParams.commodityNo;var backURL=$location.search().backURL;$scope.backURL="/index",backURL&&""!=backURL&&($scope.backURL=backURL),$scope.commodityTitles={CL:{name:"美原油",commodity:"CL"},GC:{name:"美黄金",commodity:"GC"},HSI:{name:"恒指",commodity:"HSI"},MHI:{name:"小恒指",commodity:"MHI"},SI:{name:"美白银",commodity:"SI"},DAX:{name:"德指",commodity:"DAX"},CN:{name:"富时A50",commodity:"CN"}},$scope.singAgreement=function(){var agree=document.getElementById("agreement");return agree.checked?(X.loading.show(),void UserService.outerSignAgreement($scope.commodityNo).then(function(res){var data=res.data;100==data.code?$location.url($scope.backURL):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("请先同意签署相关协议"),!1)}}),myControllers.controller("OuterAgreementCtrl",function($scope,$location,TradeService){function init(){id&&(X.loading.show(),TradeService.getStrategyInfo(id).then(function(res){var data=res.data;if(100==data.code){var tradeDirection,dataInfo=data.data;dataInfo&&(tradeDirection="B"==dataInfo.direction?"看涨":"看跌",$scope.tradeInfo={investorUsername:dataInfo.investorUsername,investorUserId:dataInfo.investorUserId,username:dataInfo.username,userId:dataInfo.userId,commodityName:dataInfo.commodityName,direction:tradeDirection,amount:dataInfo.amount,quitGain:parseInt(dataInfo.quitGain),quitLoss:parseInt(dataInfo.quitLoss)})}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}var backURL=$location.search().backURL;$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1);var id=$location.search().id;$scope.tradeInfo=null,$scope.back=function(){return backURL&&""!=backURL?($scope.backURL=backURL,!1):void($scope.backURL=window.history.back(-1))},init()}),myControllers.controller("OuterAgreementSaletorCtrl",function($scope,$location){var backURL=$location.search().backURL;$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1),$scope.back=function(){return backURL&&""!=backURL?($scope.backURL=backURL,!1):void($scope.backURL=window.history.back(-1))}}),myControllers.controller("AgreementRegister",function($scope,$location){$scope.backURL=$location.search().backURL||"/register1",$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1)}),myControllers.controller("FundCtrl",function($scope,$q,$location,PayService){function cancel(id){X.loading.show(),PayService.cancelWithdraw(id).then(function(res){var data=res.data;if(100==data.code){var withDraw=$scope.fundTypeList.withdraw;$scope.getFundDetailList(withDraw.value,withDraw.explain)}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}var pageSize=10;$scope.currType=$location.search().type||"charge",$scope.currFund=0,$scope.currPage=1,$scope.totalPage=1,$scope.showTypeDialog=!1,$scope.fundTypeList={charge:{value:"chargeWithdraw",text:"充值",explain:"income"},withdraw:{value:"chargeWithdraw",text:"提现",explain:"outcome"},income:{value:"loan",text:"收入",explain:"income"},outcome:{value:"loan",text:"支出",explain:"outcome"}},$scope.fundList=[],$scope.getFundDetailList=function(action,explain,page){var isNotTypeChanged=!1;action=action||"",page=page||1,action==$scope.fundTypeList[$scope.currType].value&&explain==$scope.fundTypeList[$scope.currType].explain&&(isNotTypeChanged=!0),X.loading.show(),PayService.getFundDetail(action,explain,page,pageSize).then(function(res){var data=res.data;if(100==data.code){var list=data.data.items;$scope.currPage=data.data.pageIndex,$scope.totalPage=data.data.totalPage,isNotTypeChanged&&1!=page?$scope.fundList=$scope.fundList.concat(list):$scope.fundList=list}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.confirmFundType=function(currType,page){page=page||1;var type=$scope.fundTypeList[currType].value,explain=$scope.fundTypeList[currType].explain;$scope.currType=currType,$scope.showTypeDialog=!1,$scope.getFundDetailList(type,explain,page)},$scope.showFundType=function(){$scope.showTypeDialog=!$scope.showTypeDialog},$scope.showCurrFundDetail=function(fundId){$scope.currFund=$scope.currFund==fundId?0:fundId},$scope.cancelWithdraw=function(fundId){X.dialog.confirm("取消提现后金额自动退还到账户余额",{notify:function(nt){1==nt&&cancel(fundId)}})},$scope.confirmFundType($scope.currType,$scope.currPage)}),myControllers.controller("PayTypeCtrl",function($scope,$q,$location){$scope.backURL=$location.search().backURL||"/myHome"}),myControllers.controller("PayBankCtrl",function($scope,$q,$location,UserService,PayService){function pay(payURL){payForm.setAttribute("action",payURL),payForm.submit()}function toIdenty(){X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&$scope.$apply(function(){$location.url("/identification?backURL=/payBank")}),0==nt&&$scope.$apply(function(){$location.url("/payType")})}})}var payForm=document.getElementById("payForm");$scope.backURL=$location.search().backURL||"/fund",$scope.balance=0,$scope.userInfo={},$scope.money="",X.loading.show(),$q.all({userInfo:UserService.getUserInfo(),balance:UserService.getBalance()}).then(function(res){var userInfoData=res.userInfo.data,balanceData=res.balance.data;100==userInfoData.code&&100==balanceData.code?($scope.balance=balanceData.data.balance,$scope.userInfo=userInfoData.data,$scope.userInfo.named?$scope.userInfo.maskName=X.maskName($scope.userInfo.name):toIdenty()):100!=userInfoData.code?X.tip(userInfoData.resultMsg):100!=balanceData.code&&X.tip(balanceData.resultMsg),payForm.removeAttribute("action"),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.pay=function(){return $scope.userInfo.named?""==$scope.money?void X.tip("请输入充值金额"):X.isMoney($scope.money,!0)?$scope.money>5e3?void X.tip("单次充值最高5000元"):(X.loading.show(),void PayService.payGateway($scope.money).then(function(res){var data=res.data;100==data.code?(pay(data.data),zhuge.track("充值",{"充值金额":$scope.money})):(X.tip(data.resultMsg),X.loading.hide())})["catch"](function(){X.tip("服务器请求异常")})):void X.tip("充值金额输入错误"):void toIdenty()}}),myControllers.controller("PayMobileCtrl",function($scope,$q,UserService,PasswordService){}),myControllers.controller("PaySuccessCtrl",function($scope,$location){var code=$location.search().code||505,money=$location.search().money||0;$scope.code=code,100==code&&0!=money&&zhuge.track("充值",{"充值金额":money})}),myControllers.controller("WithdrawCtrl",function($scope,$q,$location,UserService,PayService){function initDefaultBankCard(){if(!$scope.bankCardList.length)return void($scope.selectBankCard=null);$scope.selectBankCard=$scope.bankCardList[0];var i,bank;for(i=0;i<$scope.bankCardList.length;i++)if(bank=$scope.bankCardList[i],0==bank.defaultCard){$scope.selectBankCard=bank;break}}function initValidate(){return $scope.user.named?0==$scope.balance.balance?void X.dialog.alert("您的账户没有可提金额",{notify:function(){bootTurn("/myHome")}}):$scope.bankCardList.length?""==$scope.user.withdrawPw?void X.dialog.confirm("您还未设置提现密码",{notify:function(nt){1==nt&&bootTurn("/tradePassSet?backURL=/withdraw"),0==nt&&bootTurn("/myHome")}}):void(null!=$scope.selectBankCard&&"*"!=$scope.selectBankCard.province&&"*"!=$scope.selectBankCard.city&&"*"!=$scope.selectBankCard.subbranch||X.dialog.confirm("所选提款银行卡信息不完善<br>请先完善该银行卡信息",{notify:function(nt){1==nt&&bootTurn("/bankInfo?backURL=/withdraw"),0==nt&&bootTurn("/myHome")}})):void X.dialog.confirm("提款前请先添加提款银行卡",{notify:function(nt){1==nt&&bootTurn("/addBankCard?backURL=/withdraw"),0==nt&&bootTurn("/myHome")}}):void X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&bootTurn("/identification?backURL=/withdraw"),0==nt&&bootTurn("/myHome")}})}function bootTurn(url){$scope.$apply(function(){$location.url(url)})}$scope.money="",$scope.cardId="",$scope.password="",$scope.bankCardList=[],$scope.selectBankCard=null,$scope.balance=0,$scope.user={},$scope.userName="",$scope.showDialog=!1,X.loading.show(),$q.all({balance:UserService.getBalance(),bankCards:UserService.getBankCards(),userInfo:UserService.getUserInfo()}).then(function(res){var balanceData=res.balance.data,bankCardData=res.bankCards.data,userInfoData=res.userInfo.data;100==balanceData.code&&100==bankCardData.code&&100==userInfoData.code?($scope.bankCardList=bankCardData.data,$scope.balance=balanceData.data.balance,$scope.user=userInfoData.data,initDefaultBankCard(),initValidate()):100!=balanceData.code?X.tip(balanceData.resultMsg):100!=bankCardData.code?X.tip(bankCardData.resultMsg):100!=userInfoData.code&&X.tip(userInfoData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.sureChoose=function(index){$scope.selectBankCard=$scope.bankCardList[index],$scope.showDialog=!1},$scope.checkMoney=function(){return""==$scope.money?(X.tip("请输入提现金额"),!1):X.isMoney($scope.money)?$scope.money<100?(X.tip("提现金额最低100元起提"),!1):$scope.money>$scope.balance?(X.tip("提现金额超出您的余额"),!1):""==$scope.password?(X.tip("提现密码不为空！"),!1):/^\d{6}$/.test($scope.password)?null==$scope.selectBankCard?(X.tip("未找到您的提现银行卡信息"),!1):(X.loading.show(),void PayService.doWithdraw($scope.selectBankCard.id,$scope.money,$scope.password).then(function(res){var data=res.data;100==data.code?(X.tip("提现发起成功，等待处理中"),$location.url("/fund?type=withdraw")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("提现密码为6位数字"),!1):(X.tip("金额输入错误"),!1)}}),myControllers.controller("AddBankCardCtrl",function($scope,$q,$location,UserService,PayService,SystemService){function initValidate(){$scope.user.named||X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&bootTurnURL("/identification?backURL=/bankCardList"),0==nt&&bootTurnURL("/myInfo")}})}function bootTurnURL(url){$scope.$apply(function(){$location.url(url)})}function parseBankList(bankList){bankList&&bankList.length&&bankList.forEach(function(item){$scope.bankList[item.code]=item})}var province=SystemService.getProvince(),cities=SystemService.getCities();$scope.backURL=$location.search().backURL||"/bankCardList",$scope.bankList={},$scope.user={},$scope.showBankList=!1,$scope.userName="",$scope.bankCode="",$scope.bankName="请选择银行",$scope.showDialog=!1,$scope.list=[],$scope.provinceId="",$scope.province="请选择省",$scope.city="请选择市",$scope.branch="请选择开户支行",$scope.bankCard="",$scope.sureBankCard="",X.loading.show(),$q.all({bankList:UserService.getBankInfo(),userInfo:UserService.getUserInfo()}).then(function(res){var bankListData=res.bankList.data,userData=res.userInfo.data;100==bankListData.code&&100==userData.code?($scope.user=userData.data,$scope.userName=X.maskName($scope.user.name),parseBankList(bankListData.data),initValidate()):100!=bankListData.code?X.tip(bankListData.resultMsg):100!=userData.code&&X.tip(userData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.sureChooseBank=function(bankCode){$scope.showBankList=!1,$scope.bankCode=bankCode,$scope.bankName=$scope.bankList[bankCode].bankName,$scope.provinceId="",$scope.province="请选择省",$scope.city="请选择市",$scope.branch="请选择开户支行"},$scope.chooseProvice=function(){if($scope.title="开户省份",$scope.list=[],""==$scope.bankName||"请选择银行"==$scope.bankName)return void X.tip("请选择银行");var i,len=province.length;for(i=0;i<len;i++)$scope.list.push(province[i]);$scope.showDialog=!0},$scope.chooseCity=function(){if($scope.title="开户城市",$scope.list=[],""==$scope.bankName||"请选择银行"==$scope.bankName)return void X.tip("请选择银行");if(""==$scope.province||"请选择省"==$scope.province||""==$scope.provinceId)return void X.tip("请选择开户省份");var i,city,len=cities.length;for(i=0;i<len;i++)city=cities[i],city[0]==$scope.provinceId&&$scope.list.push([city[1],city[2]]);$scope.showDialog=!0},$scope.chooseBranch=function(){return $scope.title="开户支行",$scope.list=[],""==$scope.bankName||"请选择银行"==$scope.bankName?void X.tip("请选择银行"):""==$scope.province||"请选择省"==$scope.province?void X.tip("请选择开户省份"):""==$scope.city||"请选择市"==$scope.city?void X.tip("请选择开户城市"):($scope.showDialog=!0,X.loading.show(),void UserService.getSubBank($scope.bankName,$scope.province,$scope.city).then(function(res){var data=res.data;if(100==data.code){var i,banks=data.data,len=banks.length;for(i=0;i<len;i++)$scope.list.push([0,banks[i]]);$scope.showDialog=!0}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))},$scope.sureChoose=function(title,id,name){switch(title){case"开户省份":$scope.province=name,$scope.provinceId=id,$scope.city="请选择市",$scope.branch="请选择开户支行";break;case"开户城市":$scope.city=name,$scope.branch="请选择开户支行";break;case"开户支行":$scope.branch=name}$scope.showDialog=!1},$scope.save=function(){return""==$scope.bankName||"请选择银行"==$scope.bankName?void X.tip("请选择银行"):""==$scope.province||"请选择省"==$scope.province?void X.tip("请选择开户省份"):""==$scope.city||"请选择市"==$scope.city?void X.tip("请选择开户城市"):""==$scope.branch||"请选择开户支行"==$scope.branch?void X.tip("请选择开户支行"):""==$scope.bankCard?void X.tip("请输入银行卡号"):X.isBankCard($scope.bankCard)?""==$scope.sureBankCard?void X.tip("请输入确认卡号"):$scope.bankCard!=$scope.sureBankCard?void X.tip("确认卡号与银行卡号不一致"):(X.loading.show(),
void UserService.bindBankCard($scope.bankName,$scope.province,$scope.city,$scope.branch,$scope.bankCard).then(function(res){var data=res.data;100==data.code?(X.tip("银行卡添加成功"),$location.url($scope.backURL)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):void X.tip("请输入正确的银行卡号")}}),myControllers.controller("ModifyBankCardCtrl",function($scope,$q,$routeParams,$location,UserService,SystemService){function delBankCard(){X.loading.show(),UserService.delBankCard(bankCardId).then(function(res){var data=res.data;100==data.code?(X.tip("银行卡删除成功"),$location.url("/bankCardList")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}function toIdenty(){X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&bootTurnURL("/identification?backURL=/myInfo"),0==nt&&bootTurnURL("/myInfo")}})}function initData(){var i,len=province.length;for(i=0;i<len;i++)if($scope.bankCard.province==province[i][1]){$scope.provinceId=province[i][0];break}$scope.province=$scope.bankCard.province,$scope.city=$scope.bankCard.city,$scope.branch=$scope.bankCard.subbranch}function bootTurnURL(url){$scope.$apply(function(){$location.url(url)})}var bankCardId=$routeParams.bankCardId,province=SystemService.getProvince(),cities=SystemService.getCities();$scope.backURL=$location.search().backURL||"/bankCardList",$scope.bankCard=null,$scope.user={},$scope.showDialog=!1,$scope.list=[],$scope.provinceId="",$scope.province="请选择省",$scope.city="请选择市",$scope.branch="请选择开户支行",$scope.sureBankCard="",X.loading.show(),$q.all({bankCard:UserService.getBankCardById(bankCardId),userInfo:UserService.getUserInfo()}).then(function(res){var bankCardData=res.bankCard.data,userData=res.userInfo.data;100==bankCardData.code&&100==userData.code?($scope.user=userData.data,$scope.bankCard=bankCardData.data,""==$scope.user.name?toIdenty():initData()):X.tip(bankCardData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.chooseProvice=function(){$scope.title="开户省份",$scope.list=[];var i,len=province.length;for(i=0;i<len;i++)$scope.list.push(province[i]);$scope.showDialog=!0},$scope.chooseCity=function(){if($scope.title="开户城市",$scope.list=[],""==$scope.province||"请选择省"==$scope.province||""==$scope.provinceId)return void X.tip("请选择开户省份");var i,city,len=cities.length;for(i=0;i<len;i++)city=cities[i],city[0]==$scope.provinceId&&$scope.list.push([city[1],city[2]]);$scope.showDialog=!0},$scope.chooseBranch=function(){return $scope.title="开户支行",$scope.list=[],""==$scope.province||"请选择省"==$scope.province?void X.tip("请选择开户省份"):""==$scope.city||"请选择市"==$scope.city?void X.tip("请选择开户城市"):($scope.showDialog=!0,X.loading.show(),void UserService.getSubBank($scope.bankCard.bank,$scope.province,$scope.city).then(function(res){var data=res.data;if(100==data.code){var i,banks=data.data,len=banks.length;for(i=0;i<len;i++)$scope.list.push([0,banks[i]]);$scope.showDialog=!0}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))},$scope.sureChoose=function(title,id,name){switch(title){case"开户省份":$scope.province=name,$scope.provinceId=id,$scope.city="请选择市",$scope.branch="请选择开户支行";break;case"开户城市":$scope.city=name,$scope.branch="请选择开户支行";break;case"开户支行":$scope.branch=name}$scope.showDialog=!1},$scope.save=function(){return""==$scope.province||"请选择省"==$scope.province?void X.tip("请选择开户省份"):""==$scope.city||"请选择市"==$scope.city?void X.tip("请选择开户城市"):""==$scope.branch||"请选择开户支行"==$scope.branch?void X.tip("请选择开户支行"):(X.loading.show(),void UserService.updateCardInfo($scope.bankCard.id,$scope.bankCard.bank,$scope.province,$scope.city,$scope.branch).then(function(res){var data=res.data;100==data.code?(X.tip("银行卡信息保存成功"),$location.url($scope.backURL)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))},$scope.setDefaultBankCard=function(){X.loading.show(),UserService.setDefaultBankCard(bankCardId).then(function(res){var data=res.data;100==data.code?(X.tip("默认卡设置成功"),$location.url("/bankCardList")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.deleteBankCard=function(){X.dialog.confirm("您确定要删除该银行卡吗？",{notify:function(nt){1==nt&&delBankCard()}})}}),myControllers.controller("BankCardListCtrl",function($scope,$q,$location,UserService){function initValidate(){$scope.user.named||X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&bootTurnURL("/identification?backURL=/bankCardList"),0==nt&&bootTurnURL("/myInfo")}})}function bootTurnURL(url){$scope.$apply(function(){$location.url(url)})}$scope.bankCards=[],$scope.user={},X.loading.show(),$q.all({bankCards:UserService.getBankCards(),userInfo:UserService.getUserInfo()}).then(function(res){var bankCardData=res.bankCards.data,userData=res.userInfo.data;100==bankCardData.code&&100==userData.code?($scope.user=userData.data,$scope.bankCards=bankCardData.data,initValidate()):X.tip(bankCardData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}),myControllers.controller("BankInfoCtrl",function($scope,$q,$location,UserService,SystemService){function initValidate(){return $scope.user.named?($scope.user.maskName=X.maskName($scope.user.name),null==$scope.bank?void X.dialog.alert("未找到您的银行卡信息",{notify:function(){bootTurnURL("/myHome")}}):($scope.province="*"==$scope.bank.province?"未设置":$scope.bank.province,$scope.city="*"==$scope.bank.city?"未设置":$scope.bank.city,void($scope.branch="*"==$scope.bank.subbranch?"未设置":$scope.bank.subbranch))):void X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&bootTurnURL("/identification?backURL=/bankInfo"),0==nt&&bootTurnURL("/myInfo")}})}function bootTurnURL(url){$scope.$apply(function(){$location.url(url)})}$scope.backURL=$location.search().backURL||"/myInfo",$scope.bank={},$scope.user={},$scope.userName="",$scope.provinceId="",$scope.province="未设置",$scope.city="未设置",$scope.branch="未设置",$scope.showDialog=!1;var province=SystemService.getProvince(),cities=SystemService.getCities();X.loading.show(),$q.all({bankCardInfo:UserService.getBankCardInfo(),userInfo:UserService.getUserInfo()}).then(function(res){var bankCardData=res.bankCardInfo.data,userData=res.userInfo.data;100==bankCardData.code&&100==userData.code?($scope.user=userData.data,$scope.bank=bankCardData.data,initValidate()):X.tip(bankCardData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.closeDialog=function(){$scope.showDialog=!1},$scope.chooseProvice=function(){$scope.title="开户省份",$scope.list=[];var i,len=province.length;for(i=0;i<len;i++)$scope.list.push(province[i]);$scope.showDialog=!0},$scope.chooseCity=function(){if($scope.title="开户城市",$scope.list=[],""==$scope.province||"未设置"==$scope.province||""==$scope.provinceId)return void X.tip("请选择开户省份");var i,city,len=cities.length;for(i=0;i<len;i++)city=cities[i],city[0]==$scope.provinceId&&$scope.list.push([city[1],city[2]]);$scope.showDialog=!0},$scope.chooseBranch=function(){return $scope.title="开户支行",$scope.list=[],""==$scope.province||"未设置"==$scope.province?void X.tip("请选择开户省份"):""==$scope.city||"未设置"==$scope.city?void X.tip("请选择开户城市"):($scope.showDialog=!0,X.loading.show(),void UserService.getSubBank($scope.bank.bank,$scope.province,$scope.city).then(function(res){var data=res.data;if(100==data.code){var i,banks=data.data,len=banks.length;for(i=0;i<len;i++)$scope.list.push([0,banks[i]]);$scope.showDialog=!0}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))},$scope.sureChoose=function(title,id,name){switch(title){case"开户省份":$scope.province=name,$scope.provinceId=id,$scope.city="未设置",$scope.branch="未设置";break;case"开户城市":$scope.city=name,$scope.branch="未设置";break;case"开户支行":$scope.branch=name}$scope.showDialog=!1},$scope.save=function(){return""==$scope.province||"未设置"==$scope.province?void X.tip("请选择开户省份"):""==$scope.city||"未设置"==$scope.city?void X.tip("请选择开户城市"):""==$scope.branch||"未设置"==$scope.branch?void X.tip("请选择开户支行"):(X.loading.show(),void UserService.updateCardInfo($scope.bank.bank,$scope.province,$scope.city,$scope.branch,$scope.bank.id).then(function(res){var data=res.data;100==data.code?(X.tip("信息保存成功"),$location.url($scope.backURL)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}}),myControllers.controller("AlipayCtrl",function($scope,$q,$location,UserService,PayService){function toIdenty(){X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&$scope.$apply(function(){$location.url("/identification?backURL=/alipay")}),0==nt&&$scope.$apply(function(){$location.url("/payType")})}})}$scope.account="",$scope.money="",$scope.balance=0,$scope.user={},$scope.name="",X.loading.show(),$q.all({balance:UserService.getBalance(),userInfo:UserService.getUserInfo()}).then(function(res){var balance=res.balance.data,userData=res.userInfo.data;100==balance.code&&100==userData.code?($scope.balance=balance.data,$scope.user=userData.data,$scope.account=userData.data.alipayAccount,""==$scope.user.name?toIdenty():$scope.name=X.maskName($scope.user.name)):100!=balance.code?X.tip(balance.resultMsg):100!=userData.code&&X.tip(userData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.pay=function(){return""!=$scope.account&&$scope.account?$scope.account.length<5?void X.tip("支付宝账号输入错误"):""!=$scope.money&&$scope.money?X.isMoney($scope.money,!0)?$scope.money<1?void X.tip("充值金额最低1元"):$scope.money>1e5?void X.tip("充值金额最高10万元"):(X.loading.show(),void PayService.alipay($scope.money,$scope.account).then(function(res){var data=res.data;100==data.code?$location.url("/alipayDetail"):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):void X.tip("充值金额输入错误"):void X.tip("请输入充值金额"):void X.tip("请输入支付宝账号")}}),myControllers.controller("AlipayDetailCtrl",function(){X.clipboard.init()}),myControllers.controller("GuideCtrl",function($scope,$location){$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1)}),myControllers.controller("ArticleCtrl",function($scope,$location){$scope.showHeader=!0;var source=$location.search().source,btnName=$location.search().btnName||"",btnLink=$location.search().btnLink||"";source&&"IOSAPP"==source&&($scope.showHeader=!1),btnName&&($scope.btnName=decodeURIComponent(btnName),$scope.btnLink=decodeURIComponent(btnLink))}),myControllers.controller("SafeCtrl",function($scope,$location){$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1)}),myControllers.controller("AboutUsCtrl",function($scope,$location){$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1)}),myControllers.controller("IntroduceCtrl",function($scope,$location){$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1),$scope.toTrade=function(){$scope.showHeader?$location.path("/outerTrade/HSI/2"):window.location.href="clb://clb.yztz.cn/trade?type=1&real=false&kind=gc"}}),myControllers.controller("OuterTradeRuleCtrl",function($scope,$location){$scope.backURL=$location.search().backURL||"/guide",$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1)}),myControllers.controller("OuterTradeSellCtrl",function($scope,$q,$routeParams,$location,TradeService,SystemService,StockService){function init(HSIRisk,CLRisk,GCRisk,SIRisk,CNRisk,DAXRisk,MHIRisk){var hsiRisk=JSON.parse(HSIRisk),clRisk=JSON.parse(CLRisk),gcRisk=JSON.parse(GCRisk),siRisk=JSON.parse(SIRisk),cnRisk=JSON.parse(CNRisk),daxRisk=JSON.parse(DAXRisk),mhiRisk=JSON.parse(MHIRisk),HSICommNo=getCommNo(hsiRisk.contractCode.value),CLCommNo=getCommNo(clRisk.contractCode.value),GCCommNo=getCommNo(gcRisk.contractCode.value),SICommNo=getCommNo(siRisk.contractCode.value),CNCommNo=getCommNo(cnRisk.contractCode.value),DAXCommNo=getCommNo(daxRisk.contractCode.value),MHICommNo=getCommNo(mhiRisk.contractCode.value);options[HSICommNo]={symbol:"HK$",commodityNo:HSICommNo,contractValue:X.toFloat(hsiRisk.contractValue.value),exchangeRate:X.toFloat(hsiRisk.exchangeRate.value),fluctuationValue:X.toFloat(hsiRisk.fluctuationValue.value),isTrade:hsiRisk.isTrade.value},options[CLCommNo]={symbol:"$",commodityNo:CLCommNo,contractValue:X.toFloat(clRisk.contractValue.value),exchangeRate:X.toFloat(clRisk.exchangeRate.value),fluctuationValue:X.toFloat(clRisk.fluctuationValue.value),isTrade:clRisk.isTrade.value},options[GCCommNo]={symbol:"$",commodityNo:GCCommNo,contractValue:X.toFloat(gcRisk.contractValue.value),exchangeRate:X.toFloat(gcRisk.exchangeRate.value),fluctuationValue:X.toFloat(gcRisk.fluctuationValue.value),isTrade:gcRisk.isTrade.value},options[SICommNo]={symbol:"$",commodityNo:SICommNo,contractValue:X.toFloat(siRisk.contractValue.value),exchangeRate:X.toFloat(siRisk.exchangeRate.value),fluctuationValue:X.toFloat(siRisk.fluctuationValue.value),isTrade:siRisk.isTrade.value},options[CNCommNo]={symbol:"$",commodityNo:CNCommNo,contractValue:X.toFloat(cnRisk.contractValue.value),exchangeRate:X.toFloat(cnRisk.exchangeRate.value),fluctuationValue:X.toFloat(cnRisk.fluctuationValue.value),isTrade:cnRisk.isTrade.value},options[DAXCommNo]={symbol:"€",commodityNo:DAXCommNo,contractValue:X.toFloat(daxRisk.contractValue.value),exchangeRate:X.toFloat(daxRisk.exchangeRate.value),fluctuationValue:X.toFloat(daxRisk.fluctuationValue.value),isTrade:daxRisk.isTrade.value},options[MHICommNo]={symbol:"HK$",commodityNo:MHICommNo,contractValue:X.toFloat(mhiRisk.contractValue.value),exchangeRate:X.toFloat(mhiRisk.exchangeRate.value),fluctuationValue:X.toFloat(mhiRisk.fluctuationValue.value),isTrade:mhiRisk.isTrade.value},getFuturesSale(),X.engine.addTask(getFuturesSale,3e3),X.engine.addTask(getFuturesQuote,1e3),X.engine.start()}function getCommNo(commNo){return commNo.replace(/\d+/,"")}function initRisk(data,commo){var serverTime=data.nowTime,risk=JSON.parse(data.strRisk),holiday=SystemService.parseHoliday(risk.holiday.value),tradeTime=SystemService.parsePeriod(risk.tradingTimeLimit.value),quoteTime=SystemService.parsePeriod(risk.quoteTime.value);"1"==risk.isTrade.value;SystemService.setCurrentTime(serverTime),SystemService.setCurrentCurrencyType("USD"),SystemService.setHoliday(holiday),SystemService.setTradePeriod(tradeTime),SystemService.setQuotePeriod(quoteTime,commo)}function getFuturesSale(){TradeService.getSaleFutures($scope.type).then(function(res){var tradeData=res.data;100==tradeData.code?(currentSaleFutures=tradeData.data,getFuturesQuote(),process(),$scope.upIDsArr=[],$scope.downIDsArr=[],$scope.allIDsArr=[],$scope.saleList.forEach(function(currCommo){var direction=currCommo.direction,status=currCommo.status,commoNo=currCommo.commodityNo,isTrade="1"==options[commoNo].isTrade;if(isTrade){var isInPeriod=!1;"HSI"==commoNo?(initRisk(HSIRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")):"GC"==commoNo?(initRisk(GCRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")):"CL"==commoNo?(initRisk(CLRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")):"SI"==commoNo?(initRisk(SIRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")):"CN"==commoNo?(initRisk(CNRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")):"DAX"==commoNo?(initRisk(DAXRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")):"MHI"==commoNo&&(initRisk(MHIRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade")),isInPeriod&&4==status&&(1==direction&&$scope.upIDsArr.push(currCommo.id),direction==-1&&$scope.downIDsArr.push(currCommo.id))}$scope.upIDsArr.join(","),$scope.downIDsArr.join(","),$scope.allIDsArr=$scope.upIDsArr.concat($scope.downIDsArr)})):X.tip(tradeData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function getFuturesQuote(){var commNoStr=getSaleCommNo(currentSaleFutures);0!=commNoStr.length&&StockService.getFuturesSimpleQuote(commNoStr.join(",")).then(function(res){var quoteDataArray,quoteData=res.data;100==quoteData.code?(quoteDataArray=quoteData.data.split(";"),parseQuote(commNoStr,quoteDataArray),process()):X.tip(quoteData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function getSaleCommNo(data){var commNos=[];return data.forEach(function(commObj){var commodityNo=commObj.commodityNo;commNos.indexOf(commodityNo)==-1&&commNos.push(commodityNo)}),commNos}function parseQuote(commNoStr,quoteDataArray){quoteDataArray.length==commNoStr.length&&commNoStr.forEach(function(commNo,i){var quoteData=quoteDataArray[i],quoteDataArr=quoteData.split(",");currentPrices[commNo]=quoteDataArr[2]})}function process(){$scope.saleList=[],$scope.total=0,currentSaleFutures.forEach(function(commInfo){var commNo=commInfo.commodityNo,currOptions=options[commNo],buyPriceDeal=commInfo.buyPriceDeal,price=X.toFloat(currentPrices[commNo]),direction="B"==commInfo.direction?1:-1,amount=commInfo.amount,symbol=currOptions.symbol,status=commInfo.status,currMoney=0,rmb=0;buyPriceDeal&&(currMoney=Math.round((price-buyPriceDeal)/currOptions.fluctuationValue*amount*currOptions.contractValue*direction*100)/100,rmb=Math.round(currMoney*currOptions.exchangeRate*100)/100);var commObj={id:commInfo.id,amount:amount,commodityName:commInfo.commodityName,commodityNo:commNo,buyPriceDeal:buyPriceDeal,contractNo:commInfo.contractNo,dealTime:commInfo.dealTime,direction:direction,gainPrincipal:commInfo.gainPrincipal,lossPrincipal:commInfo.lossPrincipal,quitLoss:commInfo.quitLoss,quitGain:commInfo.quitGain,status:status,price:currentPrices[commNo],currMoney:Math.round(100*currMoney)/100,symbol:symbol,rmb:rmb,quitCloseRatio:commInfo.quitCloseRatio};$scope.saleList.push(commObj),status>3&&($scope.total=Math.round(100*($scope.total+rmb))/100)})}function getPrice(){var currPrice=0;$scope.saleList.forEach(function(currObj){currCommoNo==currObj.commodityNo&&currID==currObj.id&&(currPrice=currObj.rmb)}),$scope.rmb=currPrice}$scope.commodityNo=$routeParams.commodityNo||"CL",$scope.type=$routeParams.type||"2","1"!=$scope.type&&($scope.type="2"),$scope.commodityTitles={MHI:"小恒指",HSI:"恒指",GC:"美黄金",SI:"美白银",CL:"美原油",CN:"富时A50",DAX:"德指"},$scope.futureInfo={commodityTitle:$scope.commodityTitles[$scope.commodityNo]};var options={},currentSaleFutures=[],currentPrices={};$scope.currCommoID=0,$scope.sellOutID=0,$scope.sellAllID=0;var willSaleTradeID,sellCommoNo,HSIRiskData={},CLRiskData={},GCRiskData={},SIRiskData={},CNRiskData={},DAXRiskData={},MHIRiskData={};$scope.saleList=[],$scope.total=0,$q.all({HSIRisk:TradeService.getRisk("HSI"),CLRisk:TradeService.getRisk("CL"),GCRisk:TradeService.getRisk("GC"),SIRisk:TradeService.getRisk("SI"),CNRisk:TradeService.getRisk("CN"),DAXRisk:TradeService.getRisk("DAX"),MHIRisk:TradeService.getRisk("MHI")}).then(function(res){HSIRiskData=res.HSIRisk.data,CLRiskData=res.CLRisk.data,GCRiskData=res.GCRisk.data,SIRiskData=res.SIRisk.data,CNRiskData=res.CNRisk.data,DAXRiskData=res.DAXRisk.data,MHIRiskData=res.MHIRisk.data,100==HSIRiskData.code&&100==CLRiskData.code&&100==GCRiskData.code&&100==SIRiskData.code&&100==CNRiskData.code&&100==DAXRiskData.code&&100==MHIRiskData.code?init(HSIRiskData.data.strRisk,CLRiskData.data.strRisk,GCRiskData.data.strRisk,SIRiskData.data.strRisk,CNRiskData.data.strRisk,DAXRiskData.data.strRisk,MHIRiskData.data.strRisk):X.tip("系统错误")})["catch"](function(){X.tip("服务器请求异常")}),$scope.gainInput=0,$scope.lossInput=0;var currCommoNo="",currID=0;$scope.setGainLoss=function(tradeID,setCommoNo,setGain,setLoss){currCommoNo=setCommoNo,currID=tradeID,$scope.gainInput=setGain,$scope.lossInput=setLoss;var addObj=options[setCommoNo];willSaleTradeID=tradeID,$scope.currCommoID=1;var quitCloseRatio=0,addContractValue=addObj.contractValue,addExchangeRate=addObj.exchangeRate;$scope.saleList.forEach(function(gainLossObj){var gainLossID=gainLossObj.id;gainLossID==tradeID&&(quitCloseRatio=gainLossObj.quitCloseRatio,$scope.setWindowObj={setGainPrincipal:gainLossObj.gainPrincipal,setCommoName:gainLossObj.commodityName,setCommoNo:gainLossObj.commodityNo,setDirection:gainLossObj.direction,setAmount:gainLossObj.amount,setContractNo:gainLossObj.contractNo},$scope.onePointPrice=Math.round(addContractValue*addExchangeRate*$scope.setWindowObj.setAmount*100)/100)}),$scope.setLossPrincipal=Math.round($scope.onePointPrice*quitCloseRatio*100)/100|0,getPrice(),X.engine.addTask(getPrice,1e3)},$scope.setAdd=function(type,data,flag){data+=$scope.onePointPrice*flag,"gain"==type?($scope.gainInput=Math.round(100*data)/100,$scope.gainInput>$scope.setWindowObj.setGainPrincipal?$scope.gainInput=$scope.setWindowObj.setGainPrincipal:$scope.gainInput<$scope.onePointPrice&&($scope.gainInput=$scope.onePointPrice)):($scope.lossInput=Math.round(100*data)/100,$scope.lossInput>$scope.setLossPrincipal?$scope.lossInput=$scope.setLossPrincipal:$scope.lossInput<$scope.onePointPrice&&($scope.lossInput=$scope.onePointPrice))},$scope.confirmGainLoss=function(){if($scope.gainInput>$scope.setWindowObj.setGainPrincipal)return void X.dialog.alert("止盈金额不能大于"+$scope.setWindowObj.setGainPrincipal,{notify:function(){$scope.gainInput=$scope.setWindowObj.setGainPrincipal}});if($scope.gainInput<$scope.onePointPrice)return void X.dialog.alert("止盈金额不能小于"+$scope.onePointPrice,{notify:function(){$scope.gainInput=$scope.onePointPrice}});if($scope.lossInput>$scope.setLossPrincipal)return void X.dialog.alert("止损金额不能大于"+$scope.setLossPrincipal,{notify:function(){$scope.lossInput=$scope.setLossPrincipal}});if($scope.lossInput<$scope.onePointPrice)return void X.dialog.alert("止损金额不能小于"+$scope.onePointPrice,{notify:function(){$scope.lossInput=$scope.onePointPrice}});var setLoss=$scope.lossInput.toFixed(2),setGain=$scope.gainInput.toFixed(2);TradeService.setQuitGainLoss(willSaleTradeID,$scope.type,setLoss,setGain).then(function(res){$scope.currCommoID=0;var setData=res.data;100==setData.code?(X.dialog.alert("设置成功"),getFuturesSale()):X.tip(setData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})},$scope.sellOutDialog=function(tradeID,commo,tradeDirection,tradeCloseRadio,amount,status){willSaleTradeID=tradeID,sellCommoNo=commo,TradeService.getRisk(commo).then(function(res){var riskData=res.data;if(100==riskData.code){var riskStr=riskData.data.strRisk,risk=JSON.parse(riskStr),isTrade="1"==risk.isTrade.value;initRisk(riskData.data,sellCommoNo);var isInPeriod=SystemService.isInPeriod(commo,"trade"),tradeT=SystemService.beyondTradeTimeTips(commo);isTrade?isInPeriod?$scope.sellOutID=1:X.dialog.alert(tradeT):X.dialog.alert("暂停交易")}})["catch"](function(){X.tip("服务器异常")}),$scope.tradeDirection=tradeDirection,$scope.quitCloseRatio=tradeCloseRadio,$scope.status=status,$scope.amount=amount},$scope.chooseAllSell=function(){$scope.allSellStatus=0},$scope.chooseAllUp=function(){$scope.allSellStatus=1},$scope.chooseAllDown=function(){$scope.allSellStatus=2},$scope.allSellDialog=function(){$scope.sellAllID=1,$scope.allSellStatus=0,$scope.upIDsArr.length!=$scope.allIDsArr.length&&$scope.downIDsArr.length!=$scope.allIDsArr.length||($scope.allSellStatus=0)},$scope.choiceStatus=0,$scope.chooseSellOut=function(){$scope.choiceStatus=0},$scope.chooseBackHand=function(){$scope.choiceStatus=1},$scope.sellCurrCommodity=function(){return $scope.closeFeaturesData=[],1==$scope.sellAllID&&(0==$scope.allSellStatus?willSaleTradeID=$scope.allIDsArr:1==$scope.allSellStatus?willSaleTradeID=$scope.upIDsArr:2==$scope.allSellStatus&&(willSaleTradeID=$scope.downIDsArr)),$scope.sellAllID=0,willSaleTradeID?(X.loading.show(),void TradeService.getCloseFutures(willSaleTradeID,$scope.type).then(function(res){var data=res.data;if(100==data.code){getFuturesSale();var dataInfoArr=data.data.split(";"),sucNum=X.toFloat(dataInfoArr[0]),failNum=X.toFloat(dataInfoArr[1]),allDeal=sucNum+failNum;willSaleTradeID.length>1?X.dialog.alert("<h3>委托卖出提交完毕</h3><br>共"+allDeal+"笔，成功"+sucNum+"笔，失败"+failNum+"笔"):0==$scope.choiceStatus?1==sucNum?(X.dialog.alert("委托卖出成功"),$scope.sellOutID=0):(X.dialog.alert("委托卖出失败"),$scope.sellOutID=0):1!=sucNum?(X.dialog.alert("委托卖出失败"),$scope.sellOutID=0):($scope.closeFeaturesData=data.data,1==$scope.tradeDirection?$scope.sellBuy="sell":$scope.sellBuy="buy",$location.url("/outerTradeBuy/"+sellCommoNo+"/"+$scope.type+"/"+$scope.sellBuy+"?quitCloseRatio="+$scope.quitCloseRatio+"&amount="+$scope.amount))}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):void X.tip("策略ID不能为空")},$scope.cancelDialog=function(){1!=$scope.sellAllID&&1!=$scope.sellOutID&&1!=$scope.currCommoID||($scope.sellAllID=0,$scope.sellOutID=0,$scope.currCommoID=0)},$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("OuterTradeResultCtrl",function($scope,$q,$routeParams,TradeService){$scope.commodityNo=$routeParams.commodityNo||"CL",$scope.type=$routeParams.type||"2","1"!=$scope.type&&($scope.type="2"),$scope.commodityTitles={MHI:"小恒指",HSI:"恒指",GC:"美黄金",SI:"美白银",CL:"美原油",CN:"富时A50",DAX:"德指"},$scope.futureInfo={commodityTitle:$scope.commodityTitles[$scope.commodityNo]};var pageSize=10;$scope.settleDataList=[],$scope.currPage=1,$scope.totalPage=1,$scope.getSettleList=function(page){X.loading.show(),TradeService.getTradeResult(page,pageSize,$scope.type).then(function(res){var data=res.data;if(100==data.code){var list=data.data.dataList;$scope.currPage=data.data.pageIndex,$scope.totalPage=data.data.totalPage,1==page?$scope.settleDataList=list:$scope.settleDataList=$scope.settleDataList.concat(list)}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.getSettleList($scope.currPage),$scope.currTrade=0,$scope.showCurrTradeDetail=function(tradeId){$scope.currTrade==tradeId?$scope.currTrade=0:$scope.currTrade=tradeId}}),myControllers.controller("DevCtrl",function($scope,SystemService){$scope.showAlertDialog=!1,$scope.showAlertDialog1=!1,$scope.showConfirmDialog=!1,$scope.test111=function(){console.log(SystemService.beyondTradeTimeTips("HSI"))},$scope.test=function(){console.log("test"),$scope.showAlertDialog=!1,$scope.showAlertDialog1=!0},$scope.test1=function(){console.log("test1"),$scope.showAlertDialog1=!1},$scope.cancelNotify=function(){alert("逗逼真尼玛小气！o(︶︿︶)o 唉"),$scope.showConfirmDialog=!1},$scope.sureNotify=function(){alert("逗逼真尼玛大方！o(∩_∩)o 哈哈"),$scope.showConfirmDialog=!1}}),myControllers.controller("ActPacketCtrl",function($scope,$location,StockService,PacketService){function TipInfo(id){X.loading.show(),PacketService.getActAwardSetInfo(id).then(function(res){var data=res.data;100==data.code?data&&0!=data.length?$scope.TipInfo=data.data:$scope.TipInfo=[]:X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}var activityId=$location.search().activityId;$scope.TipInfo=[],$scope.receivePacket=function(obj){X.loading.show(),X.log(obj),PacketService.receiveTipByActivity(obj.title,obj.awardLogId,obj.value).then(function(res){var data=res.data;100==data.code?(X.tip("领取成功"),TipInfo(activityId)):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.goURL=function(name,status){if("ZCHB"==name&&0==status)$location.url("/register1?backURL=#/actPacket?activityId="+activityId);else if("MNJY"==name&&0==status)$location.url("/outerTrade/CL/1?backURL=#/actPacket?activityId="+activityId);else if("SCCZ"==name&&0==status)$location.url("/payType?backURL=#/actPacket?activityId="+activityId);else if("SPJY"==name&&0==status)$location.url("/outerTrade/CL/2?backURL=#/actPacket?activityId="+activityId);else{if("SMRZ"!=name||0!=status)return;$location.url("/identification?backURL=#/actPacket?activityId="+activityId)}},TipInfo(activityId)}),myControllers.controller("MyPacketCtrl",function($scope,$rootScope,$q,$location,LoginService,UserService,AuthService,PacketService){$scope.packetFund={},$scope.packetRecord=[],$scope.packetTitle={ZCHB:["新注册用户送红包"],MNJY:["完成模拟交易5次送红包"],SCCZ:["首次充值送红包"],SPJY:["实盘交易送红包"],SMRZ:["完成实名认证送红包"],JYZHF:["实盘交易综合费返还","实盘交易综合费抵扣"]},$scope.pageIndex=1,$scope.totalPage=1,X.loading.show(),$q.all({packetFund:PacketService.getPacketFundInfoData()}).then(function(res){var packetFund=res.packetFund.data;100==packetFund.code?($scope.packetFund=packetFund.data,$scope.getPacketRecordList($scope.pageIndex)):100!=packetFund.code&&X.tip(packetFund.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.getPacketRecordList=function(){X.loading.show(),PacketService.getPacketRecordListData().then(function(res){var data=res.data;100==data.code?$scope.items=data.data.items:X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}}),myControllers.controller("ActivityCenterCtrl",function($scope,$location,PacketService){$scope.activityList=[],PacketService.getActivityInfo().then(function(res){var data=res.data;100==data.code&&data.data?(data.data.forEach(function(item){item.bannerUrl=item.bannerUrl.split(",")}),$scope.activityList=data.data):$scope.activityList=[]})["catch"](function(){X.tip("服务器请求异常")}),$scope.goURL=function(id){$location.url("/actPacket?activityId="+id)}}),myControllers.controller("ExtensionCtrl",function($scope,$q,$location,ExtensionService){function init(data){var list=data.dataList;$scope.pageIndex=data.pageIndex,$scope.totalPage=data.totalPage,$scope.tradeCount=data.tradeCount,$scope.totalUserCount=data.totalUserCount,1==$scope.pageIndex?$scope.items=list:$scope.items=$scope.items.concat(list)}var pageSize=10;$scope.type="detail",$scope.extensionInfo={},$scope.totalUserCount="",$scope.tradeCount="",$scope.showGenerateLink=!1;var ratio=0;X.loading.show(),$q.all({extensionInfo:ExtensionService.getExtensionInfoData()}).then(function(res){var extensionInfo=res.extensionInfo.data;100==extensionInfo.code?($scope.extensionInfo=extensionInfo.data,ratio=$scope.extensionInfo.ratio,X.clipboard.init(),$scope.wechatCode="/home/generalize/getQRcode.json?device=1"):100!=extensionInfo.code&&X.tip(extensionInfo.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.getUsers=function(page){return $scope.type="user",0==ratio?void $location.url("/login?goURL=/extension"):(X.loading.show(),void ExtensionService.getExtensionUserListData(page,pageSize).then(function(res){var users=res.data;if(100==users.code){var usersData=users.data;init(usersData)}else X.tip(users.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))},$scope.getExtensionUserList=function(page){page=page||1,$scope.getUsers(page)}}),myControllers.controller("AttentionCtrl",function($scope,$location){$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1)}),myControllers.controller("AliPayIdentificationCtrl",function($scope,$location,$q,UserService){$scope.alipayAccount="",$scope.tradeAmount="",$scope.tradeNo="",$scope.submitAliPay=function(){function isMoney(data,isPositive){return isPositive?/^\d+(\.\d{0,2})?$/.test(data)&&parseFloat(data)>0:/^(-)?\d+(\.\d{1,2})?$/.test(data)}return $scope.tradeAmount||""==$scope.tradeAmount||($scope.tradeAmount=""),""==$scope.alipayAccount?void X.tip("请输入支付宝账号"):X.isMobile($scope.alipayAccount)||X.isEmail($scope.alipayAccount)?""==$scope.tradeAmount?void X.tip("请输入充值金额"):$scope.tradeAmount<1?void X.tip("充值金额最低1元"):isMoney($scope.tradeAmount,!0)?$scope.tradeAmount>1e5?void X.tip("充值金额最高10万元"):""==$scope.tradeNo?void X.tip("请输入支付宝订单号"):$scope.tradeNo.length<12?void X.tip("支付宝订单号错误"):void UserService.bindingAlipayAccount($scope.alipayAccount,$scope.tradeAmount,$scope.tradeNo).then(function(res){var data=res.data;100==data.code?(X.tip("认证成功"),$location.url("/myInfo")):501==data.code&&X.tip(data.resultMsg)})["catch"](function(){X.tip("服务器请求异常")}):void X.tip("充值金额错误"):void X.tip("支付宝账号输入错误")}}),myControllers.controller("PhoneBind1Ctrl",function($scope,$q,$location,$interval,UserService){function timerFn(){timer=setInterval(function(){$scope.time>0?$scope.$apply(function(){$scope.time--}):timer&&clearTimeout(timer)},1e3)}function changeBtnTimer(){changeTimer=$interval(function(){$scope.btnState="disabled",$scope.btnDisabled=!0,6==$scope.checkCode.length?($scope.btnState="blue",
$scope.btnDisabled=!1):($scope.btnState="disabled",$scope.btnDisabled=!0)},100)}function clearTimer(){$scope.time=0,timer&&clearTimeout(timer),changeTimer&&$interval.cancel(changeTimer),changeTimer=timer=null}var timer=null,changeTimer=null;$scope.user={},$scope.mobile="",$scope.time=0,$scope.temptimes=Date.now(),$scope.checkCode="",$scope.imgCode="",$scope.showCodeDialog=!1,X.loading.show(),$q.all({userInfo:UserService.getUserInfo()}).then(function(res){var userInfoData=res.userInfo.data;100==userInfoData.code?$scope.user=userInfoData.data:X.tip(userInfoData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.toNext=function(){return/^\d{6}$/.test($scope.checkCode)?(X.loading.show(),void UserService.unbindMobile($scope.checkCode).then(function(res){var data=res.data;100==data.code?$location.path("/phoneBind2"):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("验证码输入错误"),$scope.refreshCode(),!1)},$scope.getImgCode=function(){$scope.showCodeDialog=!0},$scope.sendCode=function(){return""==$scope.imgCode?(X.tip("请输入图片验证码"),!1):/^\d{4}$/.test($scope.imgCode)?(X.loading.show(),void UserService.mobileUnbindCode($scope.imgCode).then(function(res){var data=res.data;100==data.code?($scope.closeDialog(),X.tip("验证码发送成功，请注意查收短信"),$scope.time=60,timerFn()):101==data.code?($scope.closeDialog(),X.tip("验证码发送成功，请注意查收短信"),$scope.time=data.data.interval,timerFn()):(X.tip(data.resultMsg),$scope.refreshCode()),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("图片验证码输入错误"),$scope.refreshCode(),!1)},$scope.refreshCode=function(){$scope.temptimes=Date.now()},$scope.closeDialog=function(){$scope.showCodeDialog=!1},$scope.$on("$destroy",function(){clearTimer()}),changeBtnTimer()}),myControllers.controller("PhoneBind2Ctrl",function($scope,$routeParams,$q,$location,$interval,UserService){function timerFn(){timer=setInterval(function(){$scope.time>0?$scope.$apply(function(){$scope.time--}):timer&&clearTimeout(timer)},1e3)}function changeBtnTimer(){changeTimer=$interval(function(){$scope.btnState="disabled",$scope.btnDisabled=!0,11==$scope.mobile.length&&6==$scope.checkCode.length?($scope.btnState="blue",$scope.btnDisabled=!1):($scope.btnState="disabled",$scope.btnDisabled=!0)},100)}function clearTimer(){$scope.time=0,timer&&clearTimeout(timer),changeTimer&&$interval.cancel(changeTimer),changeTimer=timer=null}var timer=null,changeTimer=null;$scope.mobile="",$scope.oldMobile="",$scope.time=0,$scope.temptimes=Date.now(),$scope.checkCode="",$scope.imgCode="",$scope.showCodeDialog=!1,X.loading.show(),$q.all({userInfo:UserService.getUserInfo()}).then(function(res){var userInfoData=res.userInfo.data;100==userInfoData.code?$scope.oldMobile=userInfoData.data.loginMobileNoHidden:X.tip(userInfoData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.bind=function(){return X.isMobile($scope.mobile)?/^\d{6}$/.test($scope.checkCode)?(X.loading.show(),void UserService.bindMobile($scope.checkCode,$scope.mobile).then(function(res){var data=res.data;100==data.code?(X.tip("手机绑定成功"),$location.path("myInfo")):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("验证码输入错误"),$scope.refreshCode(),!1):(X.tip("手机号码输入错误"),!1)},$scope.getImgCode=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?void($scope.showCodeDialog=!0):(X.tip("手机号码输入错误"),!1)},$scope.sendCode=function(){return""==$scope.mobile?(X.tip("请输入手机号码"),!1):X.isMobile($scope.mobile)?""==$scope.imgCode?(X.tip("请输入图片验证码"),!1):/^\d{4}$/.test($scope.imgCode)?$scope.mobile==$scope.oldMobile?(X.tip("新手机号码不能和旧手机号相同"),$scope.closeDialog(),$scope.refreshCode(),!1):(X.loading.show(),void UserService.mobileBindCode($scope.imgCode,$scope.mobile).then(function(res){var data=res.data;100==data.code?($scope.closeDialog(),X.tip("验证码已发送至手机，请注意查收"),$scope.time=60,timerFn()):101==data.code?($scope.closeDialog(),X.tip("验证码已发送至手机，请注意查收"),$scope.time=data.data.interval,timerFn()):(X.tip(data.resultMsg),$scope.closeDialog(),$scope.refreshCode()),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):(X.tip("图片验证码输入错误"),$scope.refreshCode(),!1):(X.tip("手机号码输入错误"),!1)},$scope.closeDialog=function(){$scope.showCodeDialog=!1,$scope.imgCode=""},$scope.refreshCode=function(){$scope.temptimes=Date.now()},$scope.$on("$destroy",function(){clearTimer()}),changeBtnTimer()}),myControllers.controller("NewsCtrl",function($scope,$location,$sce,$window,NoticeService){function getNewsList(page,time){X.loading.show(),NoticeService.getNewsList(page,30,time).then(function(res){var data=res.data;if(100==data.code){var news=data.data||[];news.length>0?(news.forEach(function(strMsg){var msg=processNews(strMsg);/链接>>>|activity\.jin10\.com|live\.jin10\.com|app\.jin10\.com|v\.jin10\.com|news\.jin10\.com/.test(msg.content)||$scope.newsList.push(msg)}),firstTime=$scope.newsList[0].id,lastTime=$scope.newsList[$scope.newsList.length-1].id.substring(0,17),getNewsCurrDate($scope.newsList),$scope.page++,dataLoadFinish=!0):X.tip("到底了，没有新数据了")}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}function getNewsCurrDate(newsList){if(!(newsList.length<1)){var firstDate=newsList[0].date,dateArr=firstDate.split("-");$scope.month=dateArr[1],$scope.day=dateArr[2]}}function getNew(){NoticeService.getNewsList(0,20).then(function(res){var data=res.data;if(100==data.code){var news=data.data||[];if(news.length>0){for(var newData=[],i=0,len=news.length;i<len;i++){var msg=processNews(news[i]);if(!/链接>>>|activity\.jin10\.com|live\.jin10\.com|app\.jin10\.com|v\.jin10\.com|news\.jin10\.com/.test(msg.content)){if(msg.id===firstTime)break;newData.push(msg)}}newData.length>0&&($scope.newsList=newData.reverse().concat($scope.newsList),firstTime=$scope.newsList[0].id),getNewsCurrDate($scope.newsList)}}else X.tip(data.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function processNews(data){data=data.split("#");var date,time,content,important,id,imgIcon,country,evaluate,type=data[0],star=0,websiteUrl="",videoUrl="",prefix=0,expected=0,published=0,params={};return 1==type?(date=data[8].split(" ")[0],time=data[8].split(" ")[1],content=$sce.trustAsHtml(data[2].replace(/\/br/g,"br")),star=data[6],important=star>3,id=data[12],prefix=data[3],expected=data[4],published=data[5],country=data[9],evaluate=data[7],params={id:id,important:important,type:1,date:date,time:time,content:content,country:country,prefix:prefix,expected:expected,published:published,star:star,evaluate:getChangeClassText(star>=3?evaluate:evaluate+"2")}):(date=data[2].split(" ")[0],time=data[2].split(" ")[1],content=$sce.trustAsHtml(data[3].replace(/\/br/g,"br")),important=0==data[1],id=data[11],websiteUrl=data[4],imgIcon=data[6],videoUrl=data[5],params={id:id,important:important,type:0,date:date,time:time,content:content,websiteUrl:websiteUrl,showWebsiteIcon:!!websiteUrl,videoUrl:videoUrl,showVideoIcon:!!videoUrl,showImgIcon:!!imgIcon,imgName:imgIcon,imgUrl:imgIcon.replace("_lite","")}),params}function getChangeClassText(text){var classn="";"利多"==text?classn="liduo":"利空"==text?classn="likong":"无影响"==text?(text="影响较小",classn="wuyingxiang"):"利多2"==text?(text="利多",classn="liduo2"):"利空2"==text?(text="利空",classn="likong2"):"无影响2"==text&&(text="影响较小",classn="wuyingxiang2");var rege=new RegExp("影响");return rege.test(text)&&(text="影响较小"),"影响较小"!=text&&(text+=" 金银"),{className:classn,text:text}}$scope.showHeader=!0;var source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1),$scope.newsList=[],$scope.page=0,$scope.month="",$scope.day="";var lastTime=0,firstTime=0,dataLoadFinish=!1;getNewsList(0),X.engine.addTask(getNew,1e4),X.engine.start();var win=angular.element($window);win.on("scroll",function(){if(dataLoadFinish){var elem=angular.element(".viewport"),H=win.height(),T=win.scrollTop(),eH=elem.height();2*H+T>eH&&(dataLoadFinish=!1,getNewsList($scope.page,lastTime))}}),$scope.$on("$destroy",function(){X.engine.destroy(),win.off("scroll")})}),myControllers.controller("OneYuanIntroduceCtrl",function($scope,$q,$location,UserService){$scope.user={},$scope.showHeader=!0;var windowHeight=window.screen.height,imgHeight=$(".header-banner img").width()/1.61,source=$location.search().source;source&&"IOSAPP"==source&&($scope.showHeader=!1,windowHeight>50+imgHeight+386&&($(".mod-detail")[0].style.height=windowHeight-64-imgHeight+"px")),$scope.showDialog=!1,$scope.showCloseDialog=function(){$scope.showDialog=!$scope.showDialog},windowHeight>50+imgHeight+386&&($(".mod-detail")[0].style.height=windowHeight-(50+imgHeight)+"px"),$scope.goBuy=function(){$scope.showHeader?(X.loading.show(),$q.all({userInfo:UserService.getUserInfo()}).then(function(res){var userInfoData=res.userInfo.data;100==userInfoData.code?($scope.user=userInfoData.data,$location.path("/oneYuanTrade")):100!=userInfoData.code&&(X.tip(userInfoData.resultMsg),$location.url("/login?goURL=/oneYuanIntroduce")),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):window.location.href="clb://clb.yztz.cn/actTrade"}}),myControllers.controller("OneYuanTradeCtrl",function($scope,$q,$routeParams,TradeService,StockService,SystemService){function init(data){var serverTime=data.nowTime,risk=JSON.parse(data.strRisk);isTrade="1"==risk.isTrade.value;var holiday=SystemService.parseHoliday(risk.holiday.value),tradeTime=SystemService.parsePeriod(risk.tradingTimeLimit.value),quoteTime=SystemService.parsePeriod(risk.quoteTime.value);SystemService.setCurrentTime(serverTime),SystemService.setCurrentCurrencyType("USD"),SystemService.setHoliday(holiday),SystemService.setTradePeriod(tradeTime),SystemService.setQuotePeriod(quoteTime,$scope.commodityNo),getFuturesQuote(!0),X.engine.addTask(getFuturesQuote,500),X.engine.start()}function resize(){var els=["#sline-wrap-"+$scope.uuid,"#kline-wrap-"+$scope.uuid,"#tline-wrap-"+$scope.uuid],height=$(window).height();els.forEach(function(id){var top=223,h=height-top-103-5;$(id).height(h)})}function getFuturesSline(){StockService.getFuturesSline($scope.commodityNo).then(function(res){var sLineData=res.data;100==sLineData.code?drawSline(sLineData.data):X.tip(sLineData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function getFuturesKline(){StockService.getFuturesKline($scope.commodityNo).then(function(res){var kLineData=res.data;100==kLineData.code?drawKline(kLineData.data):X.tip(kLineData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function drawSline(sLineDataStr){if(resize(),QUOTE_DATA){var lastTime,slineData=sLineDataStr.split(";"),data={};slineData.forEach(function(str){var arr=str.split(",");lastTime=X.formatDate(X.toInt(arr[0]),"hm")-0,data[lastTime]={current:X.toFloat(arr[1]),volume:0,time:lastTime}}),sChart=new X.Sline(chartOpts.sline[$scope.commodityNo]),sChart.draw({data:data,close:X.toFloat(QUOTE_DATA.yesterdayPrice),high:X.toFloat(QUOTE_DATA.highPrice),low:X.toFloat(QUOTE_DATA.lowPrice),quoteTime:lastTime,code:$scope.commodityNo,period:SystemService.getRealPeriod($scope.commodityNo,lastTime),isIntl:isIntl($scope.commodityNo)})}}function drawKline(dataStr){var klineData=dataStr.split(";");klineData.reverse();var data=[];klineData.forEach(function(str){var arr=str.split(","),o={time:X.formatDate(arr[0]-0,"YMD"),open:X.toFloat(arr[4]),high:X.toFloat(arr[2]),low:X.toFloat(arr[3]),price:X.toFloat(arr[5])};data.push(o)}),kChart=new X.Kline(chartOpts.kline[$scope.commodityNo]),kChart.draw(data),CACHE_KLINE=data}function drawTick(){tChart=new X.Tick(chartOpts.tline[$scope.commodityNo]),tChart.draw({time:QUOTE_DATA.time,price:X.toFloat(QUOTE_DATA.newPrice)})}function perDrawSline(data){var o={current:X.toFloat(data.newPrice),volume:0,time:X.formatDate(data.time,"hm")-0};sChart&&sChart.perDraw(o,{close:X.toFloat(data.yesterdayPrice),high:X.toFloat(data.highPrice),low:X.toFloat(data.lowPrice),quoteTime:o.time,code:$scope.commodityNo,period:SystemService.getRealPeriod($scope.commodityNo,o.time),isIntl:isIntl($scope.commodityNo)})}function perDrawKline(data){if(0!=data.newPrice&&CACHE_KLINE&&CACHE_KLINE.length){var o={time:X.formatDate(data.time,"YMD"),open:data.openPrice,close:data.yesterdayPrice,high:data.highPrice,low:data.lowPrice,price:data.newPrice},last=CACHE_KLINE[CACHE_KLINE.length-1];last.time===o.time?CACHE_KLINE[CACHE_KLINE.length-1]=o:CACHE_KLINE.push(o),kChart&&kChart.draw(CACHE_KLINE)}}function perDrawTick(data){tChart&&tChart.draw({time:data.time,price:X.toFloat(data.newPrice)})}function getFuturesQuote(flag){isTrade?($scope.isInPeriod=SystemService.isInPeriod($scope.commodityNo,"trade"),$scope.isInPeriod?$scope.tips="本时段"+SystemService.getTipsForTradeStopTime($scope.commodityNo):$scope.tips="已休市，"+SystemService.getTipsForNextTime($scope.commodityNo)):($scope.isInPeriod=!1,$scope.tips="暂停交易");var isInQuoteTime=SystemService.isInPeriod($scope.commodityNo,"quote");flag||isInQuoteTime||$scope.$apply(),isLoadFuturesQuote&&isInQuoteTime&&(isLoadFuturesQuote=!1,StockService.getFuturesQuote($scope.commodityNo).then(function(res){isLoadFuturesQuote=!0;var data=res.data;100==data.code?processQuoteData(data.data):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}function processQuoteData(data){var futureArr;if(data){futureArr=data.split(",");var baseNum=50,buyNum=X.toInt(futureArr[12]),sellNum=X.toInt(futureArr[13]),buyNumRate=buyNum/baseNum*100,sellNumRate=sellNum/baseNum*100;buyNumRate>100&&(buyNumRate=100),sellNumRate>100&&(sellNumRate=100),QUOTE_DATA={contractNo:futureArr[0],time:futureArr[1]-0,openPrice:futureArr[2],yesterdayPrice:futureArr[3],changeValue:futureArr[4],changeQuote:futureArr[5],highPrice:futureArr[6],lowPrice:futureArr[7],total:X.sketchNumber(futureArr[8],2),newPrice:futureArr[9],buyPrice:futureArr[10],sellPrice:futureArr[11],buyNum:buyNum,sellNum:sellNum,buyNumRate:buyNumRate,sellNumRate:sellNumRate},$scope.futureInfo=QUOTE_DATA,perDrawTick(QUOTE_DATA),perDrawSline(QUOTE_DATA),perDrawKline(QUOTE_DATA)}}function isIntl(commNo){return"GC"==commNo||"CL"==commNo||"SI"==commNo||"DAX"==commNo}$scope.uuid=SystemService.uuid(),$scope.commodityNo="MHI",$scope.type="2";var tChart,sChart,kChart,QUOTE_DATA,CACHE_KLINE,chartOpts={sline:{MHI:{wrap:"sline-wrap-"+$scope.uuid,scale:0}},kline:{MHI:{wrap:"kline-wrap-"+$scope.uuid}},tline:{MHI:{wrap:"tline-wrap-"+$scope.uuid,unit:1,multiple:2}}},isLoadFuturesQuote=!0,isTrade=!1;$scope.commodityTitles={MHI:"小恒指"},$scope.showMenu=!1,$scope.futureInfo={},$scope.currType="sline",$scope.tips="",$scope.isInPeriod=!1,X.loading.show(),$q.all({risk:TradeService.getRisk($scope.commodityNo),quote:StockService.getFuturesQuote($scope.commodityNo)}).then(function(res){var riskData=res.risk.data,quoteData=res.quote.data;100==riskData.code&&100==quoteData.code?(processQuoteData(quoteData.data),init(riskData.data),$scope.switchPanel("sline")):100!=riskData.code?X.tip(riskData.resultMsg):100!=quoteData.code&&X.tip(quoteData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.switchPanel=function(type){$scope.currType=type,"sline"!=type||sChart?"tline"!=type||tChart?"kline"!=type||kChart||getFuturesKline():drawTick():getFuturesSline()},$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("OneYuanTradeBuyCtrl",function($scope,$q,$routeParams,$location,StockService,TradeService,UserService,PacketService,SystemService){function showNewContractNo(contractNo){var storage=window.localStorage,CONTRACTNO="CONTRACTNO",contractNoStr=storage.getItem(CONTRACTNO)||"";if(""==contractNoStr)return X.dialog.alert($scope.commodityTitle+"合约已更新为"+contractNo),void storage.setItem(CONTRACTNO,contractNo);var conTractNoArr=contractNoStr.split(",");conTractNoArr.indexOf(contractNo)==-1&&(X.dialog.alert($scope.commodityTitle+"合约已更新为"+contractNo),conTractNoArr.push(contractNo),storage.setItem(CONTRACTNO,conTractNoArr))}function init(data){$scope.balance=data.balance,$scope.token=data.token;var newTime=data.nowTime,risk=JSON.parse(data.strRisk),tradeTimeStr=risk.tradingTimeLimit.value;$scope.commodityTitle=risk.futuresName.value,$scope.contractNo=risk.contractCode.value,$scope.experienceQuitGainValue=risk.experienceQuitGainValue.value,$scope.experienceQuitCloseRatio=risk.experienceQuitCloseRatio.value,$scope.value=risk.contractValue.value,$scope.exchangeRate=risk.exchangeRate.value;var holiday=SystemService.parseHoliday(risk.holiday.value),tradeTime=SystemService.parsePeriod(tradeTimeStr),quoteTime=SystemService.parsePeriod(risk.quoteTime.value);isTrade="1"==risk.isTrade.value,SystemService.setCurrentTime(newTime),SystemService.setCurrentCurrencyType("USD"),SystemService.setHoliday(holiday),SystemService.setTradePeriod(tradeTime),SystemService.setQuotePeriod(quoteTime,$scope.commodityNo),getLossMoney(),getFutures(!0),X.engine.addTask(getFutures,500),X.engine.start()}function initValidate(){"1"!=$scope.type&&X.dialog.confirm("您还未实名认证，请先实名认证",{notify:function(nt){1==nt&&$location.url("/identification?backURL=/oneYuanTradeBuy/"+$scope.buyChange),0==nt&&$location.url("/oneYuanTrade")}})}function showNewContractNo(contractNo){var storage=window.localStorage,CONTRACTNO="CONTRACTNO",contractNoStr=storage.getItem(CONTRACTNO)||"";if(""==contractNoStr)return X.dialog.alert($scope.commodityTitle+"合约已更新为"+contractNo),void storage.setItem(CONTRACTNO,contractNo);var conTractNoArr=contractNoStr.split(",");conTractNoArr.indexOf(contractNo)==-1&&(X.dialog.alert($scope.commodityTitle+"合约已更新为"+contractNo),conTractNoArr.push(contractNo),storage.setItem(CONTRACTNO,conTractNoArr))}function getFutures(flag){isTrade?($scope.isInPeriod=SystemService.isInPeriod($scope.commodityNo,"trade"),$scope.isInPeriod?$scope.tips=SystemService.getTipsForTradeStopTime($scope.commodityNo):$scope.tips=SystemService.getTipsForNextTime($scope.commodityNo)):($scope.isInPeriod=!1,$scope.tips="暂停交易");var isInQuoteTime=SystemService.isInPeriod($scope.commodityNo,"quote");flag||isInQuoteTime||$scope.$apply(),isLoadFuturesQuote&&isInQuoteTime&&(isLoadFuturesQuote=!1,StockService.getFuturesQuote($scope.commodityNo).then(function(res){isLoadFuturesQuote=!0;var data=res.data;100==data.code?futureQuote(data.data):X.tip(data.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}))}function futureQuote(data){if(data){var futureArr=data.split(",");$scope.futureInfo={contractNo:futureArr[0],buyPrice:futureArr[10],sellPrice:futureArr[11]}}}function getLossMoney(){$scope.lowMoney=Math.round($scope.experienceQuitCloseRatio*$scope.value*$scope.exchangeRate*100)/100|0}function trade(){var direction="sell"==$scope.buyChange?"S":"B",postData={commodityNo:$scope.futureInfo.contractNo,type:$scope.type,useTip:!1,amount:1,direction:direction,lossPrincipal:1,gainPrincipal:$scope.experienceQuitGainValue,serviceCharge:0,contractCode:$scope.contractNo,quitLoss:$scope.lowMoney,quitGain:$scope.experienceQuitGainValue,quitCloseRatio:$scope.experienceQuitCloseRatio,token:$scope.token};X.loading.show(),TradeService.createFuturesStrategy(postData).then(function(res){var data=res.data;100==data.code?(replaceToken(data),X.dialog.alert("点买成功",{notify:function(){$location.url("/oneYuanTradeSell")}}),"2"==$scope.type&&zhuge.track("交易",{"名称":$scope.commodityNo})):(replaceToken(data),X.tip(data.resultMsg)),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})}function replaceToken(data){var token=data.data;$scope.token=token.token}$scope.buyChange=$routeParams.buyChange||"buy",$scope.commodityNo="MHI",$scope.commodityTitle="小恒指",$scope.type="2",$scope.buyChange=$routeParams.buyChange||"buy";var isLoadFuturesQuote=!0,isTrade=!1;$scope.tips="",$scope.isInperiod=!1,$scope.principal=0,$scope.serviceMoney=0,$scope.selectedLowMoney=0,$scope.selectedCount=0,$scope.futureInfo={},$scope.experienceQuitGainValue=0,$scope.experienceQuitCloseRatio=0,X.loading.show(),$q.all({userInfo:UserService.getUserInfo(),getRiskInfo:TradeService.getRisk($scope.commodityNo),quote:StockService.getFuturesQuote($scope.commodityNo),packet:PacketService.getPacketFundInfoData()}).then(function(res){var userInfoData=res.userInfo.data,riskData=res.getRiskInfo.data,packetData=res.packet.data,quoteData=res.quote.data;100==userInfoData.code&&100==riskData.code&&100==quoteData.code&&100==packetData.code?($scope.userInfo=userInfoData.data,$scope.tipBalance=packetData.data.tipBalance,0==$scope.tipBalance&&($scope.useTip=!1),init(riskData.data),futureQuote(quoteData.data),$scope.userInfo.named?showNewContractNo($scope.contractNo):initValidate()):100!=userInfoData.code?X.tip(userInfoData.resultMsg):100!=riskData.code&&X.tip(riskData.resultMsg),X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")}),$scope.toTrade=function(){var needMoney=1,tradeT=SystemService.beyondTradeTimeTips($scope.commodityNo);if(!isTrade)return X.dialog.alert("暂停交易"),!1;if($scope.futureInfo.contractNo!=$scope.contractNo)return X.dialog.alert("合约交割变更期间，无法发起策略"),!1;var isInPeriod=SystemService.isInPeriod($scope.commodityNo,"trade");return isInPeriod?"1"!=$scope.type&&$scope.balance<needMoney?(X.dialog.confirm("当前余额不足，<br>请充值后再发起策略。",{sureBtn:"去充值",notify:function(nt){1==nt&&$scope.$apply(function(){$location.url("/payType?backURL=/oneYuanTradeBuy/"+$scope.buyChange)})}}),!1):void trade():(X.dialog.alert(tradeT),!1)},$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("OneYuanTradeSellCtrl",function($scope,$q,$routeParams,$location,TradeService,SystemService,StockService){function init(MHIRisk){var mhiRisk=JSON.parse(MHIRisk),MHICommNo=getCommNo(mhiRisk.contractCode.value);options[MHICommNo]={symbol:"HK$",commodityNo:MHICommNo,contractValue:X.toFloat(mhiRisk.contractValue.value),exchangeRate:X.toFloat(mhiRisk.exchangeRate.value),fluctuationValue:X.toFloat(mhiRisk.fluctuationValue.value),isTrade:mhiRisk.isTrade.value},getFuturesSale(),X.engine.addTask(getFuturesSale,5e3),X.engine.addTask(getFuturesQuote,1e3),X.engine.start()}function getCommNo(commNo){return commNo.replace(/\d+/,"")}function initRisk(data,commo){var serverTime=data.nowTime,risk=JSON.parse(data.strRisk),holiday=SystemService.parseHoliday(risk.holiday.value),tradeTime=SystemService.parsePeriod(risk.tradingTimeLimit.value),quoteTime=SystemService.parsePeriod(risk.quoteTime.value);"1"==risk.isTrade.value;SystemService.setCurrentTime(serverTime),SystemService.setCurrentCurrencyType("USD"),SystemService.setHoliday(holiday),SystemService.setTradePeriod(tradeTime),SystemService.setQuotePeriod(quoteTime,commo)}function getFuturesSale(){0==tradeIsLoad&&TradeService.getSaleFutures($scope.type).then(function(res){var tradeData=res.data;if(100==tradeData.code){0==tradeData.data.length&&(tradeIsLoad=!0),currentSaleFutures=tradeData.data,getFuturesQuote(),process(),$scope.allIDsArr=[];var currCommo=$scope.trade;if($scope.trade.id)var status=(currCommo.direction,currCommo.status),commoNo=currCommo.commodityNo,isTrade="1"==options[commoNo].isTrade;if(isTrade){var isInPeriod=!1;initRisk(MHIRiskData.data,commoNo),isInPeriod=SystemService.isInPeriod(commoNo,"trade"),isInPeriod&&4==status&&$scope.allIDsArr.push(currCommo.id)}}else X.tip(tradeData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}function getFuturesQuote(){if(currentSaleFutures[0]){var commNoStr=currentSaleFutures[0].commodityNo;StockService.getFuturesSimpleQuote(commNoStr).then(function(res){var quoteDataArray,quoteData=res.data;100==quoteData.code?(quoteDataArray=quoteData.data,parseQuote(commNoStr,quoteDataArray),process()):X.tip(quoteData.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}}function parseQuote(commNoStr,quoteDataArray){if(""!=quoteDataArray&&""!=commNoStr){var quoteDataArr=quoteDataArray.split(",");currentPrices[commNoStr]=quoteDataArr[2]}}function process(){if(currentSaleFutures[0]){var commInfo=currentSaleFutures[0],commNo=commInfo.commodityNo,currOptions=options[commNo],buyPriceDeal=commInfo.buyPriceDeal,price=X.toFloat(currentPrices[commNo]),direction="B"==commInfo.direction?1:-1,amount=commInfo.amount,symbol=currOptions.symbol,status=commInfo.status,currMoney=0,rmb=0;buyPriceDeal&&(currMoney=Math.round((price-buyPriceDeal)/currOptions.fluctuationValue*amount*currOptions.contractValue*direction*100)/100,rmb=Math.round(currMoney*currOptions.exchangeRate*100)/100),$scope.trade={id:commInfo.id,amount:amount,commodityName:commInfo.commodityName,commodityNo:commNo,buyPriceDeal:buyPriceDeal,contractNo:commInfo.contractNo,dealTime:commInfo.dealTime,direction:direction,gainPrincipal:commInfo.gainPrincipal,lossPrincipal:commInfo.lossPrincipal,quitLoss:commInfo.quitLoss,quitGain:commInfo.quitGain,status:status,price:currentPrices[commNo],currMoney:Math.round(100*currMoney)/100,symbol:symbol,rmb:rmb,quitCloseRatio:commInfo.quitCloseRatio}}else $scope.trade={}}$scope.commodityNo="MHI",$scope.type="3",$scope.commodityTitles={MHI:"小恒指"},$scope.futureInfo={commodityTitle:$scope.commodityTitles[$scope.commodityNo]};var options={},currentSaleFutures=[],currentPrices={};$scope.currCommoID=0,$scope.sellOutID=0,$scope.trade={};var willSaleTradeID,tradeIsLoad=!1,MHIRiskData={};$scope.saleList=[],$q.all({MHIRisk:TradeService.getRisk("MHI")}).then(function(res){MHIRiskData=res.MHIRisk.data,100==MHIRiskData.code?init(MHIRiskData.data.strRisk):X.tip("系统错误")})["catch"](function(){X.tip("服务器请求异常")}),$scope.sellOutDialog=function(tradeID,commo,tradeDirection,tradeCloseRadio,amount,status){willSaleTradeID=tradeID,TradeService.getRisk(commo).then(function(res){var riskData=res.data;if(100==riskData.code){var riskStr=riskData.data.strRisk,risk=JSON.parse(riskStr),isTrade="1"==risk.isTrade.value;initRisk(riskData.data,commo);var isInPeriod=SystemService.isInPeriod(commo,"trade"),tradeT=SystemService.beyondTradeTimeTips(commo);isTrade?isInPeriod?$scope.currCommoID=1:X.dialog.alert(tradeT):X.dialog.alert("暂停交易")}})["catch"](function(){X.tip("服务器异常")}),$scope.status=status,$scope.amount=amount},$scope.choiceStatus=0,$scope.chooseSellOut=function(){$scope.choiceStatus=0},$scope.sellCurrCommodity=function(){return $scope.closeFeaturesData=[],1==$scope.currCommoID&&(willSaleTradeID=$scope.allIDsArr),$scope.sellAllID=0,willSaleTradeID?(X.loading.show(),void TradeService.getCloseFutures(willSaleTradeID,2).then(function(res){var data=res.data;if(100==data.code){tradeIsLoad=!1,getFuturesSale();var dataInfoArr=data.data.split(";"),sucNum=X.toFloat(dataInfoArr[0]);0==$scope.choiceStatus&&(1==sucNum?(X.dialog.alert("委托卖出成功"),tradeIsLoad=!1,getFuturesSale(),$scope.currCommoID=0):(X.dialog.alert("委托卖出失败"),$scope.currCommoID=0))}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})):void X.tip("策略ID不能为空")},$scope.cancelDialog=function(){1==$scope.currCommoID&&($scope.currCommoID=0)},$scope.$on("$destroy",function(){X.engine.destroy()})}),myControllers.controller("OneYuanTradeResultCtrl",function($scope,$q,$routeParams,TradeService){$scope.commodityNo="MHI",$scope.type="3",$scope.commodityTitles={MHI:"小恒指"},$scope.futureInfo={commodityTitle:$scope.commodityTitles[$scope.commodityNo]};var pageSize=10;$scope.settleDataList=[],$scope.currPage=1,$scope.totalPage=1,$scope.getSettleList=function(page){X.loading.show(),TradeService.getTradeResult(page,pageSize,$scope.type).then(function(res){var data=res.data;if(100==data.code){var list=data.data.dataList;$scope.currPage=data.data.pageIndex,$scope.totalPage=data.data.totalPage,1==page?$scope.settleDataList=list:$scope.settleDataList=$scope.settleDataList.concat(list)}else X.tip(data.resultMsg);X.loading.hide()})["catch"](function(){X.tip("服务器请求异常")})},$scope.getSettleList($scope.currPage),$scope.currTrade=0,$scope.showCurrTradeDetail=function(tradeId){$scope.currTrade==tradeId?$scope.currTrade=0:$scope.currTrade=tradeId}}),myControllers.controller("DiscoverCtrl",function($scope,$sce,NoticeService){var pageSize=10,id=0;$scope.currPage=1,$scope.totalPage=1,$scope.currNoticeIndex=0,$scope.getNoticeList=function(page){NoticeService.getNotices(page,pageSize).then(function(res){var noticeList,noticeData,data=res.data;noticeData=data.data,$scope.currPage=data.data.pageIndex,$scope.totalPage=data.data.totalPage,100==data.code?(noticeList=data.data.items,1==page?$scope.noticeList=noticeList:$scope.noticeList=$scope.noticeList.concat(noticeList)):X.tip(data.resultMsg);for(var i in $scope.noticeList)$scope.noticeList[i].noticeContent=$sce.trustAsHtml("<p style='word-break: break-all'>"+$scope.noticeList[i].noticeContent+"</p>"),$scope.noticeList[i].id=id,id++})["catch"](function(){X.tip("服务器请求异常")})},$scope.getNoticeList($scope.currPage),$scope.showCurrNotice=function(currId){$scope.currNoticeIndex==currId?$scope.currNoticeIndex=-1:$scope.currNoticeIndex=currId}}),myControllers.controller("DayGainListCtrl",function($scope,$sce,$location,RankService){function getRankData(type){RankService.getRank(type).then(function(res){var data=res.data;100==data.code?$scope.rankList=data.data:X.tip(data.resultMsg)})["catch"](function(){X.tip("服务器请求异常")})}var type=$location.search().type||"day";$scope.type=type,$scope.txtObj={day:{title:"昨日盈利榜",gainTxt:"盈利(元)"},month:{title:"佣金收入榜",gainTxt:"总收入(元)"}},X.log(type),$scope.rankList=[],"day"==type?getRankData(type):"month"==type&&getRankData(type)});var myServices=angular.module("myServices",[]);myServices.factory("URLService",function(){var baseHost="",urls={login:"/sso/yztz_user_login_check.json",logout:"/sso/j_spring_security_logout.json",imgCode:"/sso/checkCode.json",getUserInfo:"/user/userInfo/getUserInfo.json",indexShowData:"/index/getIndexData.json",getServerTime:"/home/currentTime.json",futuresServer:"/futuresquote/getFuturesQuote.json",regNextStep:"/sso/register/goNextStep.json",getRegisterCode:"/sso/register/getRegisterCode.json",doRegister:"/sso/register/doRegister.json",resetForgetPassword:"/sso/forget/resetForgetPassword.json",forgetCheckLogin:"/sso/forget/checkLogin.json",getMsgPage:"/user/messager/getMsgPage.json",postMsg:"/user/messager/postMsg.json",getBalance:"/pay/global/assets/getBalance.json",getBankInfo:"/home/getBankInfo.json",getBankCards:"/pay/bankCard/getBankCards.json",getBankCardInfo:"/pay/bankCard/getBankCardInfo.json",bindBankCard:"/pay/bankCard/bindBankCard.json",delBankCard:"/pay/bankCard/deleteCard.json",setDefaultBankCard:"/pay/bankCard/setDefaultCard.json",updateCardInfo:"/pay/bankCard/updateCardInfo.json",getBankCardById:"/pay/bankCard/getBankCardById.json",sendForgetCode:"/sso/forget/sendForgetCode.json",doWithdraw:"/pay/withdraw/doWithdraw.json",updateRealname:"/user/security/updateRealname.json",loginPwdModify:"/user/security/loginPwdModify.json",withdrawPwdSet:"/user/security/withdrawPwdSet.json",withdrawPwdModify:"/user/security/withdrawPwdModify.json",getSubBank:"/pay/bankCard/getSubBank.json",getFundDetail:"/pay/user/fundDetail/getFundDetail.json",getNoticeList:"/index/getNoticeList.json",forgetWithdrawPasswordCode:"/user/security/forgetWithdrawPasswordCode.json",resetWithdrawPwd:"/user/security/resetWithdrawPwd.json",getNoticeById:"/index/getNoticeById.json",h5FirstPayUrl:"/pay/payGateway/h5FirstPayUrl.json",h5PayUrl:"/pay/payGateway/h5PayUrl.json",payGateway:"/pay/payGateway/getHCPayUrl.json",getSaleFutures:"/futures/strategy/getSaleFuturesStrategy.json",getRisk:"/futuresindex/getRiskByCommodityNo.json",createFuturesStrategy:"/futures/strategy/createFuturesStrategy.json",getSettleStrategy:"/futures/strategy/getSettleStrategy.json",closeFutures:"/futures/strategy/closeFuturesStrategy.json",outerSignAgreement:"/futures/strategy/signAgreement.json",setQuitGainLoss:"/futures/strategy/setQuitGainLoss.json",alipay:"/pay/alipay.json",getStrategyInfo:"/futures/strategy/getStrategyInfo.json",getADBanner:"/home/header.json",getPacketInfo:"/tip/getTipInfo.json",receivePacket:"/tip/receiveTip.json",getPacketRecordList:"/tip/getTipRecord.json",getPacketFundInfo:"/tip/getTipFundInfo.json",getNewsList:"/index/getFuturesNews.json",getExtensionInfo:"/home/generalize/getGeneralizeInfo.json",getWechatCode:"/home/generalize/getQRcode.json",getExtensionUserList:"/home/generalize/getGeneralizeUsers.json",bindingAlipayAccount:"/user/security/bindingAlipayAccount.json",mobileUnbindCode:"/user/security/mobileUnbindCode.json",
unbindMobile:"/user/security/unbindMobile.json",mobileBindCode:"/user/security/mobileBindCode.json",bindMobile:"/user/security/bindMobile.json",cancelWithdraw:"/pay/withdraw/cancelWithdraw.json",getNotices:"/index/getNotices.json",getUserRank:"/index/getUserRank.json",getUnionRank:"/union/getUnionRank.json",getActivityInfo:"/activity/getActivityInfo.json",getActAwardSetInfo:"/activity/getActAwardSetInfo.json",receiveTipByActivity:"/tip/receiveTipByActivity.json"};return{getURL:function(method){return baseHost+urls[method]}}}),myServices.factory("LoginService",function($http,$httpParamSerializerJQLike,URLService){return{login:function(username,password){var data={authencationType:"AJAX",device:1,remeber:!0,entrance:"",username:username,password:password};return $http({method:"POST",url:URLService.getURL("login"),data:$httpParamSerializerJQLike(data)})},logout:function(){var data={device:1};return $http({method:"POST",url:URLService.getURL("logout"),data:$httpParamSerializerJQLike(data)})}}}),myServices.factory("RegisterService",function($http,$httpParamSerializerJQLike,URLService){return{regNextStep:function(mobile,checkCode){var data={device:1,mobile:mobile,checkCode:checkCode};return $http({method:"POST",url:URLService.getURL("regNextStep"),data:$httpParamSerializerJQLike(data)})},doRegister:function(mobile,username,password){var data={device:1,password:password,mobile:mobile,username:username};return $http({method:"POST",url:URLService.getURL("doRegister"),data:$httpParamSerializerJQLike(data)})},getRegisterCode:function(mobile,checkCode){var data={device:1,checkCode:checkCode,mobile:mobile};return $http({method:"POST",url:URLService.getURL("getRegisterCode"),data:$httpParamSerializerJQLike(data)})}}}),myServices.factory("PasswordService",function($http,$httpParamSerializerJQLike,URLService){return{resetForgetPassword:function(mobile,checkCode,password){var data={device:1,mobile:mobile,checkCode:checkCode,password:password};return $http({method:"POST",url:URLService.getURL("resetForgetPassword"),data:$httpParamSerializerJQLike(data)})},sendForgetCode:function(mobile,checkCode){var data={device:1,type:2,mobile:mobile,checkCode:checkCode};return $http({method:"POST",url:URLService.getURL("sendForgetCode"),data:$httpParamSerializerJQLike(data)})},loginPwdModify:function(oldPassword,newPassword){var data={device:1,newPassword:newPassword,oldPassword:oldPassword};return $http({method:"POST",url:URLService.getURL("loginPwdModify"),data:$httpParamSerializerJQLike(data)})},PwdSet:function(password){var data={device:1,password:password};return $http({method:"POST",url:URLService.getURL("withdrawPwdSet"),data:$httpParamSerializerJQLike(data)})},PwdModify:function(newPwd,oldPwd){var data={device:1,newPassword:newPwd,oldPassword:oldPwd};return $http({method:"POST",url:URLService.getURL("withdrawPwdModify"),data:$httpParamSerializerJQLike(data)})},resetWithdrawPwd:function(password,checkCode){var data={device:1,password:password,checkCode:checkCode};return $http({method:"POST",url:URLService.getURL("resetWithdrawPwd"),data:$httpParamSerializerJQLike(data)})},sendPasswordCode:function(){var data={device:1,useVoice:!1};return $http({method:"POST",url:URLService.getURL("forgetWithdrawPasswordCode"),data:$httpParamSerializerJQLike(data)})}}}),myServices.factory("UserService",function($http,$httpParamSerializerJQLike,URLService){return{getUserInfo:function(){var data={device:1};return $http({method:"POST",url:URLService.getURL("getUserInfo"),data:$httpParamSerializerJQLike(data)})},getBalance:function(){var data={device:1};return $http({method:"POST",url:URLService.getURL("getBalance"),data:$httpParamSerializerJQLike(data)})},getBankInfo:function(){var params={device:1};return $http({method:"GET",url:URLService.getURL("getBankInfo"),params:params})},getBankCardInfo:function(){var data={device:1};return $http({method:"POST",url:URLService.getURL("getBankCardInfo"),data:$httpParamSerializerJQLike(data)})},getBankCards:function(){var data={device:1};return $http({method:"POST",url:URLService.getURL("getBankCards"),data:$httpParamSerializerJQLike(data)})},bindingAlipayAccount:function(alipayAccount,tradeAmount,tradeNo){var data={device:1,alipayAccount:alipayAccount,tradeNo:tradeNo,tradeAmount:tradeAmount};return $http({method:"POST",url:URLService.getURL("bindingAlipayAccount"),data:$httpParamSerializerJQLike(data)})},getBankCardById:function(bankCardId){var data={device:1,cardId:bankCardId};return $http({method:"POST",url:URLService.getURL("getBankCardById"),data:$httpParamSerializerJQLike(data)})},bindBankCard:function(bank,province,city,branch,bankCard){var data={device:1,bank:bank,province:province,city:city,branch:branch,bankCard:bankCard};return $http({method:"POST",url:URLService.getURL("bindBankCard"),data:$httpParamSerializerJQLike(data)})},updateCardInfo:function(id,bank,province,city,branch){var data={device:1,bank:bank,province:province,city:city,branch:branch,id:id};return $http({method:"POST",url:URLService.getURL("updateCardInfo"),data:$httpParamSerializerJQLike(data)})},setDefaultBankCard:function(bankCardId){var data={device:1,cardId:bankCardId};return $http({method:"POST",url:URLService.getURL("setDefaultBankCard"),data:$httpParamSerializerJQLike(data)})},delBankCard:function(bankCardId){var data={device:1,cardId:bankCardId};return $http({method:"POST",url:URLService.getURL("delBankCard"),data:$httpParamSerializerJQLike(data)})},getSubBank:function(bank,province,city){var data={device:1,bankName:bank,province:province,city:city};return $http({method:"POST",url:URLService.getURL("getSubBank"),data:$httpParamSerializerJQLike(data)})},realName:function(name,IDNum){var data={device:1,name:name,idNumber:IDNum};return $http({method:"POST",url:URLService.getURL("updateRealname"),data:$httpParamSerializerJQLike(data)})},getMsgPage:function(page,pageSize){var data={device:1,page:page||1,pageSize:pageSize||10};return $http({method:"POST",url:URLService.getURL("getMsgPage"),data:$httpParamSerializerJQLike(data)})},postMsg:function(type,contact,content){var data={device:1,type:type,contact:contact,content:content};return $http({method:"POST",url:URLService.getURL("postMsg"),data:$httpParamSerializerJQLike(data)})},outerSignAgreement:function(commodityNo){var data={device:1,commodityNo:commodityNo};return $http({method:"POST",url:URLService.getURL("outerSignAgreement"),data:$httpParamSerializerJQLike(data)})},mobileUnbindCode:function(code){var data={device:1,checkCode:code};return $http({method:"POST",url:URLService.getURL("mobileUnbindCode"),data:$httpParamSerializerJQLike(data)})},unbindMobile:function(code){var data={device:1,checkCode:code};return $http({method:"POST",url:URLService.getURL("unbindMobile"),data:$httpParamSerializerJQLike(data)})},mobileBindCode:function(code,mobile){var data={device:1,checkCode:code,mobile:mobile};return $http({method:"POST",url:URLService.getURL("mobileBindCode"),data:$httpParamSerializerJQLike(data)})},bindMobile:function(code,mobile){var data={device:1,checkCode:code,mobile:mobile};return $http({method:"POST",url:URLService.getURL("bindMobile"),data:$httpParamSerializerJQLike(data)})}}}),myServices.factory("PayService",function($http,$httpParamSerializerJQLike,URLService){return{getFundDetail:function(action,explain,page,pageSize){var data={device:1,action:action,timeStart:"1year",explain:explain,page:page||1,pageSize:pageSize||20};return $http({method:"POST",url:URLService.getURL("getFundDetail"),data:$httpParamSerializerJQLike(data)})},h5FirstPayUrl:function(bankCode,money,card,charge){var data={device:1,bankCode:bankCode,money:money,bankCard:card,charge:charge};return $http({method:"POST",url:URLService.getURL("h5FirstPayUrl"),data:$httpParamSerializerJQLike(data)})},h5PayUrl:function(cardId,money,charge){var data={device:1,cardId:cardId,money:money,charge:charge};return $http({method:"POST",url:URLService.getURL("h5PayUrl"),data:$httpParamSerializerJQLike(data)})},payGateway:function(money){var data={device:1,money:money};return $http({method:"POST",url:URLService.getURL("payGateway"),data:$httpParamSerializerJQLike(data)})},alipay:function(money,account){var data={device:1,alipayName:account,money:money,charge:0};return $http({method:"POST",url:URLService.getURL("alipay"),data:$httpParamSerializerJQLike(data)})},doWithdraw:function(cardId,money,password){var data={device:1,cardId:cardId,money:money,password:password};return $http({method:"POST",url:URLService.getURL("doWithdraw"),data:$httpParamSerializerJQLike(data)})},cancelWithdraw:function(id){var data={device:1,id:id};return $http({method:"POST",url:URLService.getURL("cancelWithdraw"),data:$httpParamSerializerJQLike(data)})}}}),myServices.factory("NoticeService",function($http,$httpParamSerializerJQLike,URLService){return{getNoticeList:function(page,pageSize){var params={device:1,page:page||1,pageSize:pageSize||10};return $http({method:"GET",url:URLService.getURL("getNoticeList"),params:params})},getNoticeById:function(noticeId){var params={device:1,noticeId:noticeId};return $http({method:"GET",url:URLService.getURL("getNoticeById"),params:params})},getNewsList:function(page,pageSize,time){var params={device:1,page:page||0,pageSize:pageSize||10,time:time};return $http({method:"GET",url:URLService.getURL("getNewsList"),params:params})},getNotices:function(page,pageSize){var params={device:1,page:page||1,pageSize:pageSize||10};return $http({method:"GET",url:URLService.getURL("getNotices"),params:params})}}}),myServices.factory("TradeService",function($http,$httpParamSerializerJQLike,URLService){return{getSaleFutures:function(type){var data={device:1,type:type||2};return $http({method:"POST",url:URLService.getURL("getSaleFutures"),data:$httpParamSerializerJQLike(data)})},getTradeResult:function(page,pageSize,type){var data={device:1,type:type||2,page:page||1,pageSize:pageSize};return $http({method:"POST",url:URLService.getURL("getSettleStrategy"),data:$httpParamSerializerJQLike(data)})},getCloseFutures:function(ids,type){X.isArray(ids)&&(ids=ids.join(","));var data={device:1,ids:ids,type:type||2};return $http({method:"POST",url:URLService.getURL("closeFutures"),data:$httpParamSerializerJQLike(data)})},setQuitGainLoss:function(id,type,quitLoss,quitGain){var data={device:1,id:id,type:type||2,quitLoss:quitLoss,quitGain:quitGain};return $http({method:"POST",url:URLService.getURL("setQuitGainLoss"),data:$httpParamSerializerJQLike(data)})},getRisk:function(commodityNo){var params={device:1,commodityNo:commodityNo};return $http({method:"GET",url:URLService.getURL("getRisk"),params:params})},createFuturesStrategy:function(data){return data.device=1,$http({method:"POST",url:URLService.getURL("createFuturesStrategy"),data:$httpParamSerializerJQLike(data)})},getStrategyInfo:function(id){var data={device:1,type:2,id:id};return $http({method:"POST",url:URLService.getURL("getStrategyInfo"),data:$httpParamSerializerJQLike(data)})}}}),myServices.factory("StockService",function($http,SystemService,URLService){return{getFuturesQuote:function(commodityNo){var params={type:"real",commodityNo:commodityNo};return $http({url:URLService.getURL("futuresServer"),method:"GET",params:params})},getFuturesKline:function(commodityNo,klineType){var params={type:"kline",klineType:klineType,commodityNo:commodityNo};return $http({url:URLService.getURL("futuresServer"),method:"GET",params:params})},getFuturesSline:function(commodityNo){var params={type:"minute",commodityNo:commodityNo};return $http({url:URLService.getURL("futuresServer"),method:"GET",params:params})},getFuturesSimpleQuote:function(commodityNo){var params={type:"simpleReal",commodityNo:commodityNo};return $http({url:URLService.getURL("futuresServer"),method:"GET",params:params})}}}),myServices.factory("SystemService",function(){var holidays={CNY:{},USD:{}},TRADEPERIOD={},PERIOD={},systemTime=Date.now(),currencyType="CNY";return window.setInterval(function(){systemTime+=1e3},1e3),{getCurrentTime:function(){return systemTime},setCurrentTime:function(time){var hour=(new Date).getTimezoneOffset();systemTime=time+6e4*(480+hour)},setCurrentCurrencyType:function(type){currencyType=type},setHoliday:function(holiday){holidays[currencyType]=holiday},setTradePeriod:function(period){TRADEPERIOD=period},setQuotePeriod:function(period,type){PERIOD[type]=period},isHoliday:function(time){time&&!X.isDate(time)&&(time=new Date(time));var holiday=holidays[currencyType],now=time||new Date(systemTime),year=holiday[now.getFullYear()];if(!year)return!1;var month=year[now.getMonth()+1];if(!month)return!1;var date=now.getDate();return month.indexOf(date)!=-1},isWeekend:function(time){time=time||new Date(systemTime),time=X.isDate(time)?time:new Date(time);var t=time.getDay();return 0===t||6===t},parseHoliday:function(str){if(str){var h={},arr=str.split(",");return arr.forEach(function(dateStr){var dateArr=dateStr.split("-"),year=dateArr[0]-0,month=dateArr[1]-0,day=dateArr[2]-0;h[year]?h[year][month]?h[year][month].push(day):h[year][month]=[day]:(h[year]={},h[year][month]=[day])}),h}},parsePeriod:function(strPeriod){if(strPeriod){var outer=strPeriod.split(";"),retOuter=[];return outer.forEach(function(str){var inner=str.split("|"),retInner=[];inner.forEach(function(time){var times=time.split(",");4==times[0].length&&(times[0]="0"+times[0]),4==times[1].length&&(times[1]="0"+times[1]),retInner.push(times)}),retOuter.push(retInner)}),1==retOuter.length&&(retOuter=retOuter[0]),retOuter}},getQueryPeriod:function(commNo,type){return"trade"==type?TRADEPERIOD:PERIOD[commNo]},getRealPeriod:function(commNo,time,type){var prevTime,nextTime,period=this.getQueryPeriod(commNo,type),i=0;if(X.isArray(period[0][0]))for(;;){if(prevTime=period[i],nextTime=period[i+1],!nextTime)return prevTime;var bbt=prevTime[0][0].replace(":","")-0,ebt=nextTime[0][0].replace(":","")-0;if(time>=bbt&&time<ebt)return prevTime;i++}return period},isInPeriod:function(commNo,type){var now=new Date(systemTime),day=now.getDay(),isIn=!1;if(0==day)return isIn;var prevDay=new Date(systemTime).setDate(now.getDate()-1),prevIsHoliday=this.isHoliday(prevDay),isHoliday=this.isHoliday(),time=X.formatDate(now,"h:m"),period=this.getRealPeriod(commNo,time.replace(":","")-0,type);return period.forEach(function(t){var bTime=t[0],eTime=t[1];"00:00"===bTime&&time>=bTime&&time<eTime?prevIsHoliday||1==day||(isIn=!0):6!=day&&time>=bTime&&time<eTime&&(isIn=!isHoliday)}),isIn},getTipsForNextTime:function(commNo){function nextTradeDay(){var day=0;do day++,now.setDate(now.getDate()+1);while(t.isWeekend(now)||t.isHoliday(now));nextTime=beginTime,nextDay=day<=1?"明天":X.formatDate(now,"M月D日")}var t=this,now=new Date(systemTime),time=X.formatDate(now,"h:m"),_period=[],period=this.getQueryPeriod(commNo,"trade");X.isArray(period[0][0])?period.forEach(function(arr){_period=_period.concat(arr)}):_period=period;var i,nextTime,len=_period.length;for(i=0;i<len;i++){var timePeriod=_period[i],bt=timePeriod[0];if("00:00"!==bt&&time<bt){nextTime=bt;break}}var beginTime=_period[0][0],endTime=_period[_period.length-1][1],nextDay="今天";return(t.isWeekend(now)||t.isHoliday(now)||endTime>beginTime&&time>=endTime)&&nextTradeDay(),"下次交易时间为"+nextDay+nextTime},getTipsForTradeStopTime:function(commNo){var now=new Date(systemTime),time=X.formatDate(now,"h:m"),period=this.getRealPeriod(commNo,time.replace(":","")-0,"trade"),stopTime=period[period.length-1][1];return"持仓时间至"+stopTime},uuid:function(len){var r="0Aa1Bb2Cc3Dd4Ee5Ff6Gg7Hh8Ii9Jj0Kk1Ll2Mm3Nn4Oo5Pp6Qq7Rr8Ss9Tt0Uu1Vv2Ww3Xx4Yy5Zz6789",l=r.length,ret="";for(len=len||20;len--;)ret+=r.charAt(Math.random()*l|0);return ret},getProvince:function(){var province=[["1","北京市"],["2","天津市"],["3","河北省"],["4","山西省"],["5","内蒙古自治区"],["6","辽宁省"],["7","吉林省"],["8","黑龙江省"],["9","上海市"],["10","江苏省"],["11","浙江省"],["12","安徽省"],["13","福建省"],["14","江西省"],["15","山东省"],["16","河南省"],["17","湖北省"],["18","湖南省"],["19","广东省"],["20","广西壮族自治区"],["21","海南省"],["22","重庆市"],["23","四川省"],["24","贵州省"],["25","云南省"],["26","西藏自治区"],["27","陕西省"],["28","甘肃省"],["29","青海省"],["30","宁夏回族自治区"],["31","新疆维吾尔自治区"],["32","香港特别行政区"],["33","澳门特别行政区"],["34","台湾省"]];return province},getCities:function(){var cities=[["1","1","北京市","100000"],["2","2","天津市","100000"],["3","3","石家庄市","050000"],["3","4","唐山市","063000"],["3","5","秦皇岛市","066000"],["3","6","邯郸市","056000"],["3","7","邢台市","054000"],["3","8","保定市","071000"],["3","9","张家口市","075000"],["3","10","承德市","067000"],["3","11","沧州市","061000"],["3","12","廊坊市","065000"],["3","13","衡水市","053000"],["4","14","太原市","030000"],["4","15","大同市","037000"],["4","16","阳泉市","045000"],["4","17","长治市","046000"],["4","18","晋城市","048000"],["4","19","朔州市","036000"],["4","20","晋中市","030600"],["4","21","运城市","044000"],["4","22","忻州市","034000"],["4","23","临汾市","041000"],["4","24","吕梁市","030500"],["5","25","呼和浩特市","010000"],["5","26","包头市","014000"],["5","27","乌海市","016000"],["5","28","赤峰市","024000"],["5","29","通辽市","028000"],["5","30","鄂尔多斯市","010300"],["5","31","呼伦贝尔市","021000"],["5","32","巴彦淖尔市","014400"],["5","33","乌兰察布市","011800"],["5","34","兴安盟","137500"],["5","35","锡林郭勒盟","011100"],["5","36","阿拉善盟","016000"],["6","37","沈阳市","110000"],["6","38","大连市","116000"],["6","39","鞍山市","114000"],["6","40","抚顺市","113000"],["6","41","本溪市","117000"],["6","42","丹东市","118000"],["6","43","锦州市","121000"],["6","44","营口市","115000"],["6","45","阜新市","123000"],["6","46","辽阳市","111000"],["6","47","盘锦市","124000"],["6","48","铁岭市","112000"],["6","49","朝阳市","122000"],["6","50","葫芦岛市","125000"],["7","51","长春市","130000"],["7","52","吉林市","132000"],["7","53","四平市","136000"],["7","54","辽源市","136200"],["7","55","通化市","134000"],["7","56","白山市","134300"],["7","57","松原市","131100"],["7","58","白城市","137000"],["7","59","延边州","133000"],["8","60","哈尔滨市","150000"],["8","61","齐齐哈尔市","161000"],["8","62","鸡西市","158100"],["8","63","鹤岗市","154100"],["8","64","双鸭山市","155100"],["8","65","大庆市","163000"],["8","66","伊春市","152300"],["8","67","佳木斯市","154000"],["8","68","七台河市","154600"],["8","69","牡丹江市","157000"],["8","70","黑河市","164300"],["8","71","绥化市","152000"],["8","72","大兴安岭地区","165000"],["9","73","上海市","200000"],["10","74","南京市","210000"],["10","75","无锡市","214000"],["10","76","徐州市","221000"],["10","77","常州市","213000"],["10","78","苏州市","215000"],["10","79","南通市","226000"],["10","80","连云港市","222000"],["10","81","淮安市","223200"],["10","82","盐城市","224000"],["10","83","扬州市","225000"],["10","84","镇江市","212000"],["10","85","泰州市","225300"],["10","86","宿迁市","223800"],["11","87","杭州市","310000"],["11","88","宁波市","315000"],["11","89","温州市","325000"],["11","90","嘉兴市","314000"],["11","91","湖州市","313000"],["11","92","绍兴市","312000"],["11","93","金华市","321000"],["11","94","衢州市","324000"],["11","95","舟山市","316000"],["11","96","台州市","318000"],["11","97","丽水市","323000"],["12","98","合肥市","230000"],["12","99","芜湖市","241000"],["12","100","蚌埠市","233000"],["12","101","淮南市","232000"],["12","102","马鞍山市","243000"],["12","103","淮北市","235000"],["12","104","铜陵市","244000"],["12","105","安庆市","246000"],["12","106","黄山市","242700"],["12","107","滁州市","239000"],["12","108","阜阳市","236100"],["12","109","宿州市","234100"],["12","110","巢湖市","238000"],["12","111","六安市","237000"],["12","112","亳州市","236800"],["12","113","池州市","247100"],["12","114","宣城市","366000"],["13","115","福州市","350000"],["13","116","厦门市","361000"],["13","117","莆田市","351100"],["13","118","三明市","365000"],["13","119","泉州市","362000"],["13","120","漳州市","363000"],["13","121","南平市","353000"],["13","122","龙岩市","364000"],["13","123","宁德市","352100"],["14","124","南昌市","330000"],["14","125","景德镇市","333000"],["14","126","萍乡市","337000"],["14","127","九江市","332000"],["14","128","新余市","338000"],["14","129","鹰潭市","335000"],["14","130","赣州市","341000"],["14","131","吉安市","343000"],["14","132","宜春市","336000"],["14","133","抚州市","332900"],["14","134","上饶市","334000"],["15","135","济南市","250000"],["15","136","青岛市","266000"],["15","137","淄博市","255000"],["15","138","枣庄市","277100"],["15","139","东营市","257000"],["15","140","烟台市","264000"],["15","141","潍坊市","261000"],["15","142","济宁市","272100"],["15","143","泰安市","271000"],["15","144","威海市","265700"],["15","145","日照市","276800"],["15","146","莱芜市","271100"],["15","147","临沂市","276000"],["15","148","德州市","253000"],["15","149","聊城市","252000"],["15","150","滨州市","256600"],["15","151","菏泽市","255000"],["16","152","郑州市","450000"],["16","153","开封市","475000"],["16","154","洛阳市","471000"],["16","155","平顶山市","467000"],["16","156","安阳市","454900"],["16","157","鹤壁市","456600"],["16","158","新乡市","453000"],["16","159","焦作市","454100"],["16","160","濮阳市","457000"],["16","161","许昌市","461000"],["16","162","漯河市","462000"],["16","163","三门峡市","472000"],["16","164","南阳市","473000"],["16","165","商丘市","476000"],["16","166","信阳市","464000"],["16","167","周口市","466000"],["16","168","驻马店市","463000"],["17","169","武汉市","430000"],["17","170","黄石市","435000"],["17","171","十堰市","442000"],["17","172","宜昌市","443000"],["17","173","襄樊市","441000"],["17","174","鄂州市","436000"],["17","175","荆门市","448000"],["17","176","孝感市","432100"],["17","177","荆州市","434000"],["17","178","黄冈市","438000"],["17","179","咸宁市","437000"],["17","180","随州市","441300"],["17","181","恩施州","445000"],["17","182","神农架","442400"],["18","183","长沙市","410000"],["18","184","株洲市","412000"],["18","185","湘潭市","411100"],["18","186","衡阳市","421000"],["18","187","邵阳市","422000"],["18","188","岳阳市","414000"],["18","189","常德市","415000"],["18","190","张家界市","427000"],["18","191","益阳市","413000"],["18","192","郴州市","423000"],["18","193","永州市","425000"],["18","194","怀化市","418000"],["18","195","娄底市","417000"],["18","196","湘西土家族苗族自治州","416000"],["19","197","广州市","510000"],["19","198","韶关市","521000"],["19","199","深圳市","518000"],["19","200","珠海市","519000"],["19","201","汕头市","515000"],["19","202","佛山市","528000"],["19","203","江门市","529000"],["19","204","湛江市","524000"],["19","205","茂名市","525000"],["19","206","肇庆市","526000"],["19","207","惠州市","516000"],["19","208","梅州市","514000"],["19","209","汕尾市","516600"],["19","210","河源市","517000"],["19","211","阳江市","529500"],["19","212","清远市","511500"],["19","213","东莞市","511700"],["19","214","中山市","528400"],["19","215","潮州市","515600"],["19","216","揭阳市","522000"],["19","217","云浮市","527300"],["20","218","南宁市","530000"],["20","219","柳州市","545000"],["20","220","桂林市","541000"],["20","221","梧州市","543000"],["20","222","北海市","536000"],["20","223","防城港市","538000"],["20","224","钦州市","535000"],["20","225","贵港市","537100"],["20","226","玉林市","537000"],["20","227","百色市","533000"],["20","228","贺州市","542800"],["20","229","河池市","547000"],["20","230","来宾市","546100"],["20","231","崇左市","532200"],["21","232","海口市","570000"],["21","233","三亚市","572000"],["22","234","重庆市","400000"],["23","235","成都市","610000"],["23","236","自贡市","643000"],["23","237","攀枝花市","617000"],["23","238","泸州市","646100"],["23","239","德阳市","618000"],["23","240","绵阳市","621000"],["23","241","广元市","628000"],["23","242","遂宁市","629000"],["23","243","内江市","641000"],["23","244","乐山市","614000"],["23","245","南充市","637000"],["23","246","眉山市","612100"],["23","247","宜宾市","644000"],["23","248","广安市","638000"],["23","249","达州市","635000"],["23","250","雅安市","625000"],["23","251","巴中市","635500"],["23","252","资阳市","641300"],["23","253","阿坝藏族羌族自治州","624600"],["23","254","甘孜藏族自治州","626000"],["23","255","凉山州","615000"],["24","256","贵阳市","55000"],["24","257","六盘水市","553000"],["24","258","遵义市","563000"],["24","259","安顺市","561000"],["24","260","铜仁地区","554300"],["24","261","黔西南州","551500"],["24","262","毕节地区","551700"],["24","263","黔东南州","551500"],["24","264","黔南州","550100"],["25","265","昆明市","650000"],["25","266","曲靖市","655000"],["25","267","玉溪市","653100"],["25","268","保山市","678000"],["25","269","昭通市","657000"],["25","270","丽江市","674100"],["25","271","思茅市","665000"],["25","272","临沧市","677000"],["25","273","楚雄州","675000"],["25","274","红河州","654400"],["25","275","文山州","663000"],["25","276","西双版纳州","666200"],["25","277","大理州","671000"],["25","278","德宏州","678400"],["25","279","怒江州","671400"],["25","280","迪庆州","674400"],["26","281","拉萨市","850000"],["26","282","昌都地区","854000"],["26","283","山南地区","856000"],["26","284","日喀则地区","857000"],["26","285","那曲地区","852000"],["26","286","阿里地区","859100"],["26","287","林芝地区","860100"],["27","288","西安市","710000"],["27","289","铜川市","727000"],["27","290","宝鸡市","721000"],["27","291","咸阳市","712000"],["27","292","渭南市","714000"],["27","293","延安市","716000"],["27","294","汉中市","723000"],["27","295","榆林市","719000"],["27","296","安康市","725000"],["27","297","商洛市","711500"],["28","298","兰州市","730000"],["28","299","嘉峪关市","735100"],["28","300","金昌市","737100"],["28","301","白银市","730900"],["28","302","天水市","741000"],["28","303","武威市","733000"],["28","304","张掖市","734000"],["28","305","平凉市","744000"],["28","306","酒泉市","735000"],["28","307","庆阳市","744500"],["28","308","定西市","743000"],["28","309","陇南市","742100"],["28","310","临夏回族自治州","731100"],["28","311","甘南藏族自治州","747000"],["29","312","西宁市","810000"],["29","313","海东地区","810600"],["29","314","海北藏族自治州","810300"],["29","315","黄南藏族自治州","811300"],["29","316","海南藏族自治州","813000"],["29","317","果洛藏族自治州","814000"],["29","318","玉树藏族自治州","815000"],["29","319","海西蒙古族藏族自治州","817000"],["30","320","银川市","750000"],["30","321","石嘴山市","753000"],["30","322","吴忠市","751100"],["30","323","固原市","756000"],["30","324","中卫市","751700"],["31","325","乌鲁木齐市","830000"],["31","326","克拉玛依市","834000"],["31","327","吐鲁番地区","838000"],["31","328","哈密地区","839000"],["31","329","昌吉回族自治州","831100"],["31","330","博尔塔拉蒙古自治州","833400"],["31","331","巴音郭楞蒙古自治州","841000"],["31","332","阿克苏地区","843000"],["31","333","克孜勒苏柯尔克孜自治州","835600"],["31","334","喀什地区","844000"],["31","335","和田地区","848000"],["31","336","伊犁哈萨克自治州","833200"],["31","337","塔城地区","834700"],["31","338","阿勒泰地区","836500"],["31","339","石河子市","832000"],["31","340","阿拉尔市","843300"],["31","341","图木舒克市","843900"],["31","342","五家渠市","831300"],["32","343","香港特别行政区","000000"],["33","344","澳门特别行政区","000000"],["34","345","台湾省","000000"]];return cities},beyondTradeTimeTips:function(commNo){var i,len,sc,_period=[],str=[],period=this.getQueryPeriod(commNo,"trade"),head="非交易时间不可交易<br><br>【{{COMMNO}}的买入时间】<br>",commodity={HSI:"恒指",GC:"美黄金",SI:"美白银",CL:"美原油",CN:"富时A50",DAX:"德指",MHI:"小恒指"};if(!X.isArray(period))return"";for(X.isArray(period[0][0])?period.forEach(function(arr){_period=_period.concat(arr)}):_period=period,len=_period.length,i=0;i<len;i++){var timePeriod=_period[i],bt=timePeriod[0],et=timePeriod[1];"24:00"==et&&_period[i+1]&&"00:00"==_period[i+1][0]?(str.push(bt+" - "+_period[i+1][1]+"<br>"),i++):str.push(bt+" - "+et+"<br>")}return sc=head+str.join("")+"（周末及节假日休市）",sc.replace("{{COMMNO}}",commodity[commNo])}}}),myServices.factory("AuthService",function(){var sessionStorage=window.sessionStorage;return{auth:function(){var session=sessionStorage.getItem("sessionID"),now=Date.now(),timeOut=72e5;if(!session)return!1;var sessionArr=session.split("#"),lastLoginTime=sessionArr[1];return now-lastLoginTime>timeOut?(sessionStorage.removeItem("sessionID"),!1):(sessionArr[1]=now,sessionStorage.setItem("sessionID",sessionArr.join("#")),!0)},signIn:function(userID){var authStr=[userID,Date.now()].join("#");sessionStorage.setItem("sessionID",authStr)},signOut:function(){sessionStorage.removeItem("sessionID")}}}),myServices.factory("myInterceptor",function($location,AuthService){var interceptor={request:function(config){return config},response:function(response){return X.isObject(response.data)&&(100==response.data.code?AuthService.auth():405==response.data.code&&(AuthService.signOut(),$location.path("/login").replace())),response},requestError:function(rejection){return rejection},responseError:function(rejection){return rejection}};return interceptor}),myServices.factory("ADBannerService",function($http,$httpParamSerializerJQLike,URLService){return{getADBannerData:function(){var params={device:1};return $http({method:"GET",url:URLService.getURL("getADBanner"),params:params})}}}),myServices.factory("PacketService",function($http,$httpParamSerializerJQLike,URLService){return{getPacketInfoData:function(){var params={device:1};return $http({method:"GET",url:URLService.getURL("getPacketInfo"),params:params})},receivePacketData:function(title,money){var params={device:1,title:title,money:money};return $http({method:"POST",url:URLService.getURL("receivePacket"),params:params})},getPacketFundInfoData:function(){var params={device:1};return $http({method:"GET",url:URLService.getURL("getPacketFundInfo"),params:params})},getPacketRecordListData:function(){var params={device:1};return $http({method:"GET",url:URLService.getURL("getPacketRecordList"),params:params})},getActivityInfo:function(){var params={device:1,agentCode:"YZTZ"};return $http({method:"GET",url:URLService.getURL("getActivityInfo"),params:params})},getActAwardSetInfo:function(activityId){var params={device:1,agentCode:"YZTZ",activityId:activityId};return $http({method:"GET",url:URLService.getURL("getActAwardSetInfo"),params:params})},receiveTipByActivity:function(title,awardLogId,money){var params={device:1,agentCode:"YZTZ",title:title,awardLogId:awardLogId,money:money};return $http({method:"POST",url:URLService.getURL("receiveTipByActivity"),params:params})}}}),myServices.factory("ExtensionService",function($http,$httpParamSerializerJQLike,URLService){return{getExtensionInfoData:function(){var params={device:1};return $http({method:"POST",url:URLService.getURL("getExtensionInfo"),params:params})},getExtensionUserListData:function(page,pageSize){var params={device:1,page:page,pageSize:pageSize};return $http({method:"POST",url:URLService.getURL("getExtensionUserList"),params:params})}}}),myServices.factory("RankService",function($http,$httpParamSerializerJQLike,URLService){return{getRank:function(type){var url="day"==type?URLService.getURL("getUserRank"):URLService.getURL("getUnionRank"),params={device:1};return $http({method:"GET",url:url,params:params})}}});var myDirectives=angular.module("myDirectives",[]);myDirectives.directive("commonTitle",function(){return{restrict:"EA",replace:!0,template:function(){var html="";return html+="<h3>",html+="<span ng-click=\"showMenu=!showMenu\">{{type=='1'?'模拟盘' : '实盘'}} - 点买{{futureInfo.commodityTitle}}",html+=' <i ng-if="!showMenu" class="iconfont">&#xe608;</i><i ng-if="showMenu" class="iconfont">&#xe609;</i>',html+="</span>",html+="</h3>"}}}),myDirectives.directive("commonMenu",function(){return{restrict:"EA",replace:!0,template:function(){var html="";return html+='<div ng-show="showMenu" ng-click="showMenu=false;" class="mod-commodity-list db-bg" style="z-index: 99;">',html+='<div class="wrap">',html+='<a ng-repeat="(key, value) in commodityTitles" href="#/outerTrade/{{key}}/{{type}}" ng-if="value != futureInfo.commodityTitle">{{value}}</a>',html+="</div>",html+="</div>"}}}),myDirectives.directive("dialog",function(){return{restrict:"EA",replace:!0,transclude:!0,template:'<div class="db-bg" ng-transclude style="z-index: 10000"></div>'}}),myDirectives.directive("slide",function($timeout){return{restrict:"EA",replace:!0,transclude:!0,template:'<div class="mod-slide" ng-transclude  ng-swipe-right="swipeRight();" ng-swipe-left="swipeLeft();"></div>',link:function($scope,$el){function swipe(dir){clearTimer();var next="L"==dir?index+1:index-1;next=next<0?len-1:next>len-1?0:next,li.eq(index).animate({left:"L"==dir?"-100%":"100%"}),menu.removeClass("curr"),menu.eq(next).addClass("curr"),li.eq(next).css({left:"L"==dir?"100%":"-100%"}).animate({left:"0"},function(){index=next}),timer=$timeout(function(){$scope.swipeLeft()},3e3)}function createMenu(){for(var menu='<ul class="slide-menu">',i=0;i<len;i++)menu+="<li></li>";menu+="</ul>",$el.append(menu)}function clearTimer(){timer&&$timeout.cancel(timer),timer=null}var timer,index=0,li=$el.find("ul.slide-wrap > li"),len=li.length;if(createMenu(),!(len<2)){var menu=$el.find("ul.slide-menu > li");li.css("left","100%"),li.eq(0).css("left",0),menu.eq(0).addClass("curr"),$scope.swipeRight=function(){swipe("R")},$scope.swipeLeft=function(){swipe("L")},timer=$timeout(function(){$scope.swipeLeft()},3e3),$scope.$on("$destroy",function(){clearTimer()})}}}}),myDirectives.directive("alert",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{
alertDataObj:"=",notify:"&"},template:function($el,$attr){var title=$attr.title,sureBtn=$attr.sureBtn||"确定",html=[];return html.push('<div class="db-bg">'),html.push('<div class="mod-dialog-alert">'),title&&html.push("<header>"+title+"</header>"),html.push('<div class="content" ng-transclude>'),html.push("</div>"),html.push("<footer>"),html.push('<div ng-click="notify();">'+sureBtn+"</div>"),html.push("</footer>"),html.push("</div>"),html.push("</div>"),html.join("")}}}),myDirectives.directive("confirm",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{confirmDataObj:"=",sureNotify:"&",cancelNotify:"&"},template:function($el,$attr){var title=$attr.title,cancelBtn=$attr.cancelBtn||"取消",sureBtn=$attr.sureBtn||"确定",html=[];return html.push('<div class="db-bg">'),html.push('<div class="mod-dialog-confirm">'),title&&html.push("<header>"+title+"</header>"),html.push('<div class="content" ng-transclude>'),html.push("</div>"),html.push("<footer>"),html.push('<div ng-click="cancelNotify();">'+cancelBtn+"</div>"),html.push('<div ng-click="sureNotify();">'+sureBtn+"</div>"),html.push("</footer>"),html.push("</div>"),html.push("</div>"),html.join("")}}}),myDirectives.directive("backMenu",function($location){return{restrict:"EA",replace:!0,template:function(){var backURL=$location.search().backURL,historyLen=window.history.length;return historyLen<2&&(backURL="/index"),backURL?'<a href="#'+backURL+'" class="nav-left"><i class="icon-back"></i></a>':'<a href="javascript:window.history.back();" class="nav-left"><i class="icon-back"></i></a>'}}});